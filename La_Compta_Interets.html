<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul des Intérêts</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: black;
        }
        .header {
            text-align: center;
            padding: 15px;
			position: relative;
            border-top: 5px solid #1EFF00;
            border-bottom: 5px solid #FF9000;
            background-color: #78004f;
            border-radius: 8px;
            margin-bottom: 20px;
			text-shadow: 2px 2px 4px rgba(0,0,0,1);
        }
        h1 {
            color: white;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .problem-container {
            background-color: #F3E5F5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .input-container {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border: 1px solid #CCC;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        button {
            background-color: #7B1FA2;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
			transition: all 0.3s ease;
			text-shadow: 1px 1px 2px rgba(0,0,0,1);
			box-shadow: 4px 4px 6px rgba(0,0,0,0.5);
        }		
        button:hover {
            background-color: #6A1B9A;
			transform: translateY(-2px);
			box-shadow: 6px 6px 12px rgba(0,0,0,0.5);
        }
    button.generate {
        background-color: #ffbf47; /* Vert */
    }
    button.generate:hover {
        background-color: #ffa500; /* Vert */
    }
    button.check {
        background-color: #61b865; /* Bleu */
    }
    button.check:hover {
        background-color: #00b50d; /* Bleu */
    }
    button.reponse {
        background-color: #5eabcc; /* Orange */
    }
    button.reponse:hover {
        background-color: #0088c2; /* Orange */
    }	
    button.quit {
        background-color: #ff4747; /* Rouge */
    }
	button.quit:hover {
        background-color: #ff0000; /* Rouge */
    }


	.solution {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #E8F5E9;
            border-radius: 8px;
        }
        .variable {
            font-weight: bold;
            color: #7B1FA2;
        }
        .formula {
            font-style: italic;
            margin: 10px 0;
        }
        .tax-note {
            color: #D32F2F;
            font-weight: bold;
            margin-top: 10px;
        }
        .success {
            color: #388E3C;
            font-weight: bold;
        }
        .error {
            color: #D32F2F;
            font-weight: bold;
        }

		.calcul-pad {
			position: fixed;
			top: 50%;
			right: 20px;
			transform: translateY(-50%);
			width: 350px;
			background: white;
			border: 2px solid #4b0082;
			border-radius: 8px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			z-index: 1000;
			display: block;
			cursor: move;
			user-select: none;
		}

		.calcul-pad-header {
			background: #4b0082;
			color: white;
			padding: 10px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			cursor: move;
		}

		.calcul-pad-content {
			padding: 5px;
			height: 200px;
			user-select: text;
		}

		.calcul-pad textarea {
			width: 100%;
			height: 100%;
			border: 1px solid #ddd;
			border-radius: 4px;
			padding: 0px;
			font-family: monospace;
			resize: none;
			user-select: text;
		}		

		.info-icon {
			position: absolute;
			top: 15px;
			right: 15px;
			background-color: #51FF46;
			color: black;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			text-align: center;
			line-height: 24px;
			font-weight: bold;
			cursor: pointer;
			font-size: 16px;
			font-style: italic;
			font-family: serif;
			box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
			transition: all 0.3s ease;
		}

		.info-icon:hover {
			background-color: #FDCF00;
			transform: scale(1.1);
		}
		
		.info-icon:hover::after {
			content: "Rappel de la théorie";
			position: absolute;
			top: -30px;
			right: 0;
			background: #333;
			color: white;
			padding: 5px 10px;
			border-radius: 4px;
			font-size: 12px;
			white-space: nowrap;
			font-style: normal;
			font-family: Arial, sans-serif;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
		}

		.modal-content {
			background-color: #3c3c54;
			margin: 5% auto;
			padding: 25px;
			border-radius: 10px;
			width: 80%;
			max-width: 600px;
			border: 3px solid #51FF46;
			box-shadow: 0px 0px 20px rgba(81, 255, 70, 0.5);
			position: relative;
		}

		.close {
			color: #ff4747;
			float: right;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			line-height: 1;
		}

		.close:hover {
			color: #ff0000;
			text-shadow: 0px 0px 10px rgba(255, 0, 0, 0.7);
		}
		
		.theory-title {
			color: #51FF46;
			border-bottom: 2px solid #FDCF00;
			padding-bottom: 10px;
			margin-top: 0;
		}

		.theory-content {
			line-height: 1;
			margin-top: 15px;
			color: white;
		}		
    </style>
</head>
<body>
    <div class="header">
        <h1>Le calcul des intérêts</h1>
		<div class="info-icon" onclick="showTheory()">i</div>
    </div>

    <div class="container">
        <div class="problem-container">
            <h2>Problème</h2>
            <p id="problem-text">Cliquez sur "Générer un problème" pour commencer.</p>
        </div>

        <div class="input-container">
            <label for="answer">Votre réponse:</label>
            <input type="number" id="answer" step="0.01" placeholder="Entrez votre réponse">
        </div>
		
		<button class="check"  onclick="checkAnswer()">Valider</button>
        <button class="generate" onclick="generateProblem()">Nouvel exerice</button-new>
        <button class="reponse" onclick="showSolution()">Afficher la solution</button>
		<button class="quit" onclick="window.close()">Quitter</button>
        
		<div id="result-message"></div>

        <div id="solution" class="solution">
            <h3>Solution détaillée</h3>
            <div id="solution-steps"></div>
        </div>
    </div>

<div class="calcul-pad">
    <div class="calcul-pad-header">
        <span>Bloc-notes de calculs</span>
        <button onclick="toggleCalculPad()" style="background:none; border:none; color:white; font-size:16px; cursor:pointer;">×</button>
    </div>
    <div class="calcul-pad-content">
        <textarea id="calculPadText" placeholder="Notez vos calculs ici..."></textarea>
    </div>
</div>	

		<!-- Pop-up théorique -->
		<div id="theoryModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeTheory()">&times;</span>
				<h2 class="theory-title">Rappel théorique - Changes</h2>
				<div class="theory-content">
				<p>
					Méthode 1 : Par simple règle de trois<br>
					<span class="monospace">CAN&nbsp;&nbsp;&nbsp;: 78'000   =>  CAN au PM ?</span><br>
					<span class="monospace">PRAMV&nbsp;: 52'000</span><br>
					<span class="monospace">BB&nbsp;&nbsp;&nbsp;&nbsp;: 26'000   =>  22'000</span><br>
					<span class="monospace">FF&nbsp;&nbsp;&nbsp;&nbsp;: 22'000   =>  22'000</span><br>
					<span class="monospace">BN&nbsp;&nbsp;&nbsp;&nbsp;:  4'000   =>       0</span><br>
					<span class="monospace">PM = 78'000 × 22'000 ÷ 26'000 = <strong>CHF 66'000.-</strong></span><br>
				</p>

				<p>
					Méthode 2 : Avec le % de marge brute<br>
					<span class="monospace">CAN&nbsp;&nbsp;&nbsp;: 78'000 => 100%&nbsp;&nbsp;&nbsp;=> x</span><br>
					<span class="monospace">PRAMV&nbsp;: 52'000</span><br>
					<span class="monospace">BB&nbsp;&nbsp;&nbsp;&nbsp;: 26'000 => 33.33% => 22'000</span><br>
					<span class="monospace">FF&nbsp;&nbsp;&nbsp;&nbsp;: 22'000</span><br>
					<span class="monospace">BN&nbsp;&nbsp;&nbsp;&nbsp;:  4'000 =>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=>&nbsp;&nbsp;0</span><br>
					<span class="monospace">PM = 22'000 × 100 ÷ 33.3333 = <strong>CHF 66'000.-</strong></span><br>
				</p>

				<p>
					Méthode 3 : Par calcul unitaire<br>
					<span class="monospace">PV unitaire : CHF 18</span><br>
					<span class="monospace">PA unitaire : CHF  8</span><br>
					<span class="monospace">BB unitaire : CHF 10</span><br>
					<span class="monospace">Frais fixe : 750</span>
					<br>Quantité au point mort = FF ÷ Marge unitaire
					<br>Calcul : 750 ÷ 10 = 75 unités
					<br>CA au point mort = 75 × 18 = CHF 1'350.-
				</p>
				</div>
			</div>
		</div>	

    <script>
		document.addEventListener('keydown', function(e) {
			if (e.keyCode == 123 || // F12
				(e.ctrlKey && e.shiftKey && e.keyCode == 73) || // Ctrl+Shift+I
				(e.ctrlKey && e.keyCode == 85)) { // Ctrl+U
				e.preventDefault();
			}
		});	
	
	function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "'");
}


        let currentProblem = {};
        let expectedAnswer = 0;

        function generateProblem() {
            // Masquer les résultats précédents
            document.getElementById('result-message').innerHTML = '';
            document.getElementById('solution').style.display = 'none';
            document.getElementById('answer').value = '';
            
            // Générer des valeurs aléatoires
			const minCapital = 1000;
			const maxCapital = 100000;
			const capitalStep = 100;
			// Nombre de tranches possibles
			const numSteps = Math.floor((maxCapital - minCapital) / capitalStep);
			// Choisir une tranche aléatoire
			const randomStep = Math.floor(Math.random() * (numSteps + 1));
			// Calculer le capital correspondant
			const capital = minCapital + randomStep * capitalStep;

			const minRate = 1.5;
			const maxRate = 8;
			const step = 0.25;
			const randomSteps = Math.floor(Math.random() * ((maxRate - minRate) / step + 1));
			const rate = (minRate + randomSteps * step).toFixed(2);
			
            const days = Math.floor(Math.random() * 360) + 1; // Entre 1 et 360 jours
            
            // Déterminer quelle variable sera à trouver (c, t, i, n ou inet)
            const variables = ['c', 't', 'i', 'n', 'inet'];
            const unknownVariable = variables[Math.floor(Math.random() * variables.length)];
            
            // Calculer l'intérêt brut
            const rawInterest = capital * rate * days / 36000;
            const roundedInterest = Math.round(rawInterest * 20) / 20; // Arrondi à 0.05 près
            const interest = roundedInterest.toFixed(2);
            
            // Stocker le problème actuel
            currentProblem = {
                capital,
                rate,
                days,
                interest,
                unknownVariable
            };
            
            // Générer le texte du problème
            let problemText = '';
            
            switch(unknownVariable) {
                case 'c':
                    problemText = `Un capital placé à un taux de ${rate}% pendant ${days} jours a généré des intérêts de CHF ${formatNumber(interest)}. Quel était le montant du capital initial?`;
                    expectedAnswer = capital;
                    break;
                case 't':
                    problemText = `Un capital de CHF ${formatNumber(capital)} placé pendant ${days} jours a généré des intérêts de CHF ${interest}. Quel était le taux d'intérêt?`;
                    expectedAnswer = rate;
                    break;
                case 'i':
                    problemText = `Un capital de CHF ${formatNumber(capital)} est placé à un taux de ${rate}% pendant ${days} jours. Calculez l'intérêt brut.`;
                    expectedAnswer = parseFloat(interest);
                    break;
                case 'n':
                    problemText = `Un capital de CHF ${formatNumber(capital)} placé à un taux de ${rate}% a généré des intérêts de CHF ${formatNumber(interest)}. Quelle était la durée du placement en jours?`;
                    expectedAnswer = days;
                    break;
                case 'inet':
                    problemText = `Un capital de CHF ${formatNumber(capital)} est placé à un taux de ${rate}% pendant ${days} jours. Calculez l'intérêt net (après déduction de l'impôt anticipé de 35%).`;
                    // Calculer l'intérêt net
                    const tax = (parseFloat(interest) * 0.35).toFixed(2);
                    const netInterest = (parseFloat(interest) - parseFloat(tax)).toFixed(2);
                    expectedAnswer = parseFloat(netInterest);
                    break;
            }
            
            document.getElementById('problem-text').innerHTML = problemText;
        }
        
        function checkAnswer() {
            const userAnswer = parseFloat(document.getElementById('answer').value);
            
            if (isNaN(userAnswer)) {
                document.getElementById('result-message').innerHTML = '<span class="error">Veuillez entrer une réponse valide.</span>';
                return;
            }
            
            // Tolérance pour les calculs à virgule flottante
            const tolerance = 0.1;
            const isCorrect = Math.abs(userAnswer - expectedAnswer) < tolerance;
            
            if (isCorrect) {
                document.getElementById('result-message').innerHTML = '<span class="success">Correct! Félicitations.</span>';
            } else {
                document.getElementById('result-message').innerHTML = `<span class="error">Incorrect. La réponse attendue était ${expectedAnswer}.</span>`;
            }
        }
        
        function showSolution() {
            const solutionDiv = document.getElementById('solution');
            const solutionSteps = document.getElementById('solution-steps');
            
            solutionSteps.innerHTML = '';
            
            // Afficher les variables connues
            let html = '<p><strong>Variables connues:</strong></p><ul>';
            
            if (currentProblem.unknownVariable !== 'c') {
                html += `<li>c = CHF ${formatNumber(currentProblem.capital)}</li>`;
            }
            if (currentProblem.unknownVariable !== 't') {
                html += `<li>t = ${currentProblem.rate}%</li>`;
            }
            if (currentProblem.unknownVariable !== 'i' && currentProblem.unknownVariable !== 'inet') {
                html += `<li>i = CHF ${formatNumber(currentProblem.interest)}</li>`;
            }
            if (currentProblem.unknownVariable !== 'n') {
                html += `<li>n = ${currentProblem.days} jours</li>`;
            }
            
            html += '</ul>';
            
            // Afficher la formule générale
            html += `<p class="formula">Formule générale: i = c × t × n / 36000</p>`;
            
            // Afficher la formule réarrangée selon la variable inconnue
            switch(currentProblem.unknownVariable) {
                case 'c':
                    html += `<p>Formule réarrangée pour trouver c: c = i × 36000 / (t × n)</p>`;
                    html += `<p>Calcul: c = ${currentProblem.interest} × 36000 / (${currentProblem.rate} × ${currentProblem.days})</p>`;
                    html += `<p>c = ${(currentProblem.interest * 36000).toFixed(2)} / ${(currentProblem.rate * currentProblem.days).toFixed(2)}</p>`;
                    html += `<p>c = ${currentProblem.capital.toFixed(2)} CHF</p>`;
                    break;
                case 't':
                    html += `<p>Formule réarrangée pour trouver t: t = i × 36000 / (c × n)</p>`;
                    html += `<p>Calcul: t = ${currentProblem.interest} × 36000 / (${currentProblem.capital} × ${currentProblem.days})</p>`;
                    html += `<p>t = ${(currentProblem.interest * 36000).toFixed(2)} / ${(currentProblem.capital * currentProblem.days).toFixed(2)}</p>`;
                    html += `<p>t = ${currentProblem.rate}%</p>`;
                    break;
                case 'i':
                    html += `<p>Calcul direct: i = ${currentProblem.capital} × ${currentProblem.rate} × ${currentProblem.days} / 36000</p>`;
                    html += `<p>i = ${(currentProblem.capital * currentProblem.rate * currentProblem.days).toFixed(2)} / 36000</p>`;
                    
                    let grossInterest = currentProblem.interest;
                    html += `<p>i = ${grossInterest} CHF (intérêt brut)</p>`;
                    break;
                case 'n':
                    html += `<p>Formule réarrangée pour trouver n: n = i × 36000 / (c × t)</p>`;
                    html += `<p>Calcul: n = ${currentProblem.interest} × 36000 / (${currentProblem.capital} × ${currentProblem.rate})</p>`;
                    html += `<p>n = ${(currentProblem.interest * 36000).toFixed(2)} / ${(currentProblem.capital * currentProblem.rate).toFixed(2)}</p>`;
                    html += `<p>n = ${currentProblem.days} jours</p>`;
                    break;
                case 'inet':
                    html += `<p>Calcul de l'intérêt brut: i = ${currentProblem.capital} × ${currentProblem.rate} × ${currentProblem.days} / 36000</p>`;
                    html += `<p>i = ${(currentProblem.capital * currentProblem.rate * currentProblem.days).toFixed(2)} / 36000</p>`;
                    
                    const grossInterestNet = currentProblem.interest;
                    html += `<p>i = ${grossInterestNet} CHF (intérêt brut)</p>`;
                    
                    // Calcul de l'impôt et de l'intérêt net
                    const tax = (parseFloat(grossInterestNet) * 0.35).toFixed(2);
                    const netInterest = (parseFloat(grossInterestNet) - parseFloat(tax)).toFixed(2);
                    
                    html += `<p>Impôt anticipé (35%): ${grossInterestNet} × 0.35 = ${tax} CHF</p>`;
                    html += `<p>Intérêt net: ${grossInterestNet} - ${tax} = ${netInterest} CHF</p>`;
                    break;
            }
            
            solutionSteps.innerHTML = html;
            solutionDiv.style.display = 'block';
        }
        
		// Fonctions pour le pop-up théorique
		function showTheory() {
			document.getElementById('theoryModal').style.display = 'block';
		}

		function closeTheory() {
			document.getElementById('theoryModal').style.display = 'none';
		}

		// Fermer le pop-up si on clique en dehors
		window.onclick = function(event) {
			const modal = document.getElementById('theoryModal');
			if (event.target === modal) {
				closeTheory();
			}
		}		
		
        // Générer un problème au chargement de la page
        window.onload = generateProblem;

// Fonctions pour le bloc-notes de calculs
function toggleCalculPad() {
    const calculPad = document.querySelector('.calcul-pad');
    calculPad.style.display = calculPad.style.display === 'none' ? 'block' : 'none';
}

// Fonctions pour le déplacement du cadre
function makeCalculPadDraggable() {
    const calculPad = document.querySelector('.calcul-pad');
    const header = document.querySelector('.calcul-pad-header');
    
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    
    header.onmousedown = dragMouseDown;
    
    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Get the mouse cursor position at startup
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // Call a function whenever the cursor moves
        document.onmousemove = elementDrag;
        calculPad.classList.add('moving');
    }
    
    function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // Set the element's new position
        calculPad.style.top = (calculPad.offsetTop - pos2) + "px";
        calculPad.style.left = (calculPad.offsetLeft - pos1) + "px";
        calculPad.style.right = "auto";
        calculPad.style.transform = "none";
    }
    
    function closeDragElement() {
        // Stop moving when mouse button is released
        document.onmouseup = null;
        document.onmousemove = null;
        calculPad.classList.remove('moving');
    }
}

// Modifier la fonction toggleCalculPad pour qu'elle cache/affiche au lieu d'ouvrir/fermer
function toggleCalculPad() {
    const calculPad = document.querySelector('.calcul-pad');
    calculPad.style.display = calculPad.style.display === 'none' ? 'block' : 'none';
}

// Supprimer l'événement du bouton toggle (puisqu'il n'existe plus)
// document.querySelector('.calcul-pad-toggle').addEventListener('click', toggleCalculPad);

// Modifier l'initialisation pour ne pas cacher le cadre au chargement
window.addEventListener('load', function() {
    const savedContent = localStorage.getItem('calculPadContent');
    if (savedContent) {
        document.getElementById('calculPadText').value = savedContent;
    }
    // Rendre le cadre déplaçable après le chargement
    makeCalculPadDraggable();
    
    // Ne pas cacher le cadre - il est déjà visible par défaut
});	




    </script>
	
		<div style="text-align: center; margin-top: 30px; font-style: italic; color: #ffb5fb; padding: 10px;">
			"Je fais de la compta et c'est ma joie!", DG, EPC Fribourg
		</div>
	
		<!-- Pop-up théorique -->
		<div id="theoryModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeTheory()">&times;</span>
				<h2 class="theory-title">Rappel théorique - Le calcul des intérêts</h2>
				<div class="theory-content">
					<p>Formule de base à retenir : COTON!</p>
					<p>c x t x n<br>-------- = i <br>    36000</p>
					<p><br>i = intérêts en CHF<br>c = capital (montant le plus gros de la donnée!)<br>t = taux d'intérêt<br>n = nombre de jours</p>
					<p>Remarque : si n = nombre de mois, on divise par 1200, car il y a 12 mois dans l'année (et x100 car 5% = 5 / 100)</p>
					<p><br>Chercher autre chose que i, c'est toujours i x 36000 divisé par les autres variables!
                    <p><br>Pour l'intérêt net, on déduit l'impôt anticipé de 35% de l'intérêt brut.</p>
				</div>
			</div>
		</div>

		
		
</body>
</html>