<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul du Point Mort - Exercice</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: black;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
			border-bottom: 5px solid #00FF36;
        }
        .title-container {
            background-color: #4a148c; /* Violet foncé */
            border-top: 5px solid #FFF98F; 
            border-bottom: 5px solid #8FFFFB;
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
			box-shadow: 0 -8px 8px 2px rgba(255,242,18,0.4);
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        .questions {
            margin: 10px 0;
        }
        .question {
            margin-bottom: 10px;
            padding: 6px 15px;
            background-color: #F9E0FF;
			font-weight: bold;
            border-left: 4px solid #520066;
            display: flex;
            justify-content: space-between;
            align-items: center;
			border-radius: 8px;
			max-height: 30px; /* Hauteur minimale réduite */
			box-shadow: 0 2px 4px rgba(0,0,0,0.7);
        }
        .question-text {
            flex: 1;
			margin: 0;
        }
        .answer-input {
            width: 100px;
            padding: 4px;
            margin-left: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
			box-shadow: 4px 4px 6px rgba(0,0,0,0.6);
        }
        #validateBtn {
            background-color: #61b865;
            color: white;
        }
		#validateBtn:hover {
            background-color: #00b50d;
        }
        #newExerciseBtn {
            background-color: #ffbf47;
            color: white;
        }
        #newExerciseBtn:hover {
            background-color: #ffa500;
        }		
        #showAnswersBtn {
            background-color: #5eabcc;
            color: white;
        }
        #showAnswersBtn:hover {
            background-color: #0088c2;
        }		
        #quitBtn {
            background-color: #ff4747;
            color: white;
        }
        #quitBtn:hover {
            background-color: #ff0000;
        }		
        button:hover {
			box-shadow: 6px 6px 8px rgba(0,0,0,0.6);
			transform: translateY(-4px);
        }
        .answer {
            font-weight: bold;
            margin-top: 5px;
        }
        .correct {
            color: #4CAF50;
        }
        .incorrect {
            color: #f44336;
        }
        .hidden {
            display: none;
        }
        .result {
            margin-top: 5px;
            font-weight: bold;
            margin-left: 10px;
        }
        .score {
            text-align: center;
            margin: 15px 0;
            font-size: 18px;
            font-weight: bold;
            color: #4a148c;
        }
        .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 1px 15px 1px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="title-container">
        <h1>Calcul du Point Mort (Break Even Point)</h1>
    </div>
    
    <div class="container">
        <div class="info-box">
            <p><strong>Note :</strong> Les réponses sont acceptées avec une tolérance de ±50 CHF pour tenir compte des arrondis.</p>
        </div>
        
        <div class="chart-container">
            <canvas id="breakEvenChart"></canvas>
        </div>
        
        <div class="score" id="scoreDisplay">Score: 0/4</div>
        
        <div class="questions">
            <div class="question">
                <div class="question-text">
                    <p>1. Quelle est la quantité au point mort ?</p>
                </div>
                <input type="number" id="input1" class="answer-input" placeholder="Quantité">
                <span id="result1" class="result"></span>
            </div>
            <div class="question">
                <div class="question-text">
                    <p>2. Quel est le chiffre d'affaires au point mort (en CHF) ?</p>
                </div>
                <input type="number" id="input2" class="answer-input" placeholder="CHF">
                <span id="result2" class="result"></span>
            </div>
            <div class="question">
                <div class="question-text">
                    <p>3. Quel est le bénéfice ou la perte lorsqu'on vend <span id="qtyX">X</span> articles (en CHF) ?</p>
                </div>
                <input type="number" id="input3" class="answer-input" placeholder="CHF">
                <span id="result3" class="result"></span>
            </div>
            <div class="question">
                <div class="question-text">
                    <p>4. Quel est le bénéfice ou la perte lorsqu'on vend <span id="qtyY">Y</span> articles (en CHF) ?</p>
                </div>
                <input type="number" id="input4" class="answer-input" placeholder="CHF">
                <span id="result4" class="result"></span>
            </div>
        </div>
        
        <div class="buttons">
            <button id="validateBtn">Valider</button>
            <button id="newExerciseBtn">Nouvel exercice</button>
            <button id="showAnswersBtn">Afficher les réponses</button>
            <button id="quitBtn">Quitter</button>
        </div>
    </div>

    <script>
        // Variables globales pour stocker les données de l'exercice
        let fixedCosts, variableCostPerUnit, sellingPricePerUnit, breakEvenQuantity, breakEvenRevenue;
        let chart;
        let score = 0;
        let qtyX, qtyY;
        const TOLERANCE = 50; // Tolérance de ±5 CHF pour les réponses
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            generateNewExercise();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            document.getElementById('validateBtn').addEventListener('click', validateAnswers);
            document.getElementById('newExerciseBtn').addEventListener('click', generateNewExercise);
            document.getElementById('showAnswersBtn').addEventListener('click', showAnswers);
            document.getElementById('quitBtn').addEventListener('click', function() {
                if (confirm('Voulez-vous vraiment quitter ?')) {
                    window.close();
                }
            });
        }
        
        function generateNewExercise() {
            // Générer des valeurs aléatoires avec des montants plus petits
            fixedCosts = Math.floor(Math.random() * 8 + 3) * 100; // Entre 300 et 1000 par pas de 100
            variableCostPerUnit = Math.floor(Math.random() * 4 + 1) * 10; // Entre 10 et 40 par pas de 10
            sellingPricePerUnit = variableCostPerUnit + Math.floor(Math.random() * 4 + 1) * 10; // Supérieur au coût variable
            
            // Calculer le point mort
            breakEvenQuantity = Math.ceil(fixedCosts / (sellingPricePerUnit - variableCostPerUnit));
            breakEvenRevenue = breakEvenQuantity * sellingPricePerUnit;
            
            // Générer des quantités aléatoires pour les questions 3 et 4
            qtyX = Math.floor(Math.random() * (breakEvenQuantity * 2 - breakEvenQuantity + 1)) + breakEvenQuantity;
            
            // Pour qtyY, générer une quantité différente de qtyX
            do {
                qtyY = Math.floor(Math.random() * (breakEvenQuantity * 2 - 10 + 1)) + 10;
            } while (qtyY === qtyX);
            
            // Mettre à jour l'affichage
            updateChart();
            updateQuestions();
            resetInputs();
            updateScore(0);
        }
        
        function updateChart() {
            const ctx = document.getElementById('breakEvenChart').getContext('2d');
            
            // Détruire le graphique existant s'il y en a un
            if (chart) {
                chart.destroy();
            }
            
            // Calculer les données pour le graphique - LIMITE À 100
            const maxQuantity = Math.min(breakEvenQuantity * 2, 100); // Ne pas dépasser 100
            const quantities = Array.from({length: maxQuantity + 1}, (_, i) => i);
            
            const revenues = quantities.map(q => q * sellingPricePerUnit);
            const totalCosts = quantities.map(q => fixedCosts + (q * variableCostPerUnit));
            
            // Créer le graphique
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: quantities,
                    datasets: [
                        {
                            label: 'Chiffre d\'affaires (CA)',
                            data: revenues,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            fill: false,
                            tension: 0
                        },
                        {
                            label: 'Coûts totaux',
                            data: totalCosts,
                            borderColor: 'red',
                            backgroundColor: 'rgba(255, 0, 0, 0.1)',
                            fill: false,
                            tension: 0
                        },
                        {
                            label: 'Coûts fixes',
                            data: quantities.map(() => fixedCosts),
                            borderColor: 'green',
                            borderDash: [5, 5],
                            backgroundColor: 'rgba(0, 128, 0, 0.1)',
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Quantité'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'CHF'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'none', //remplacé top par none pour enlever la légende
                        },
                        tooltip: {
                            mode: 'none',  //remplacé index par none pour enlever le tooltip sur les ronds du graphique
                            intersect: false
                        }
                    }
                }
            });
        }
        
        function updateQuestions() {
            document.getElementById('qtyX').textContent = qtyX;
            document.getElementById('qtyY').textContent = qtyY;
        }
        
        function resetInputs() {
            // Réinitialiser tous les champs de saisie
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`input${i}`).value = '';
                document.getElementById(`result${i}`).textContent = '';
                document.getElementById(`result${i}`).className = 'result';
            }
        }
        
        // Fonction pour vérifier si une réponse est correcte avec tolérance
        function isAnswerCorrect(userAnswer, correctAnswer) {
            return Math.abs(userAnswer - correctAnswer) <= TOLERANCE;
        }
        
        function validateAnswers() {
            let newScore = 0;
            
            // Question 1: Quantité au point mort (pas de tolérance pour les quantités)
            const answer1 = parseInt(document.getElementById('input1').value);
            if (answer1 === breakEvenQuantity) {
                document.getElementById('result1').textContent = '✓ Correct';
                document.getElementById('result1').className = 'result correct';
                newScore++;
            } else if (!isNaN(answer1)) {
                document.getElementById('result1').textContent = '✗ Incorrect';
                document.getElementById('result1').className = 'result incorrect';
            }
            
            // Question 2: Chiffre d'affaires au point mort (avec tolérance)
            const answer2 = parseInt(document.getElementById('input2').value);
            if (isAnswerCorrect(answer2, breakEvenRevenue)) {
                document.getElementById('result2').textContent = '✓ Correct';
                document.getElementById('result2').className = 'result correct';
                newScore++;
            } else if (!isNaN(answer2)) {
                document.getElementById('result2').textContent = '✗ Incorrect';
                document.getElementById('result2').className = 'result incorrect';
            }
            
            // Question 3: Bénéfice/perte pour qtyX articles (avec tolérance)
            const revenueX = qtyX * sellingPricePerUnit;
            const totalCostX = fixedCosts + (qtyX * variableCostPerUnit);
            const profitLossX = revenueX - totalCostX;
            
            const answer3 = parseInt(document.getElementById('input3').value);
            if (isAnswerCorrect(answer3, profitLossX)) {
                document.getElementById('result3').textContent = '✓ Correct';
                document.getElementById('result3').className = 'result correct';
                newScore++;
            } else if (!isNaN(answer3)) {
                document.getElementById('result3').textContent = '✗ Incorrect';
                document.getElementById('result3').className = 'result incorrect';
            }
            
            // Question 4: Bénéfice/perte pour qtyY articles (avec tolérance)
            const revenueY = qtyY * sellingPricePerUnit;
            const totalCostY = fixedCosts + (qtyY * variableCostPerUnit);
            const profitLossY = revenueY - totalCostY;
            
            const answer4 = parseInt(document.getElementById('input4').value);
            if (isAnswerCorrect(answer4, profitLossY)) {
                document.getElementById('result4').textContent = '✓ Correct';
                document.getElementById('result4').className = 'result correct';
                newScore++;
            } else if (!isNaN(answer4)) {
                document.getElementById('result4').textContent = '✗ Incorrect';
                document.getElementById('result4').className = 'result incorrect';
            }
            
            updateScore(newScore);
        }
        
        function updateScore(newScore) {
            score = newScore;
            document.getElementById('scoreDisplay').textContent = `Score: ${score}/4`;
        }
        
        function showAnswers() {
            // Afficher les bonnes réponses
            document.getElementById('input1').value = breakEvenQuantity;
            document.getElementById('input2').value = breakEvenRevenue;
            
            const revenueX = qtyX * sellingPricePerUnit;
            const totalCostX = fixedCosts + (qtyX * variableCostPerUnit);
            const profitLossX = revenueX - totalCostX;
            
            document.getElementById('input3').value = profitLossX;
            
            const revenueY = qtyY * sellingPricePerUnit;
            const totalCostY = fixedCosts + (qtyY * variableCostPerUnit);
            const profitLossY = revenueY - totalCostY;
            
            document.getElementById('input4').value = profitLossY;
            
            // Valider automatiquement pour afficher les résultats
            validateAnswers();
        }
    </script>
</body>
</html>