<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul de Rendement des Immeubles</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000000;
        }
        .header {
            background-color: #78004f;
            color: white;
            width: 100%;
            max-width: 850px;
            position: relative;
			padding: 20px;
            border-radius: 12px;
            margin: 0px auto 30px;
            text-align: center;
			border-top: 8px solid #44F527;
			border-bottom: 4px solid #ffff00;
            box-shadow: 0px 0px 15px 5px rgba(255,240,125, 0.6);
        }	
        .titre {
            font-size: 32px;
            font-weight: bold;
        }		
        
        h1 {
            color: #4b0082; /* Violet foncé */
            border-top: 5px solid #1e90ff; /* Bleu */
            border-bottom: 5px solid #ffd700; /* Jaune */
            padding: 10px 0;
            text-align: center;
        }
        
		.container {
			display: flex;
			gap: 20px;
			margin-top: 20px;
			justify-content: center; /* Ajouté pour centrer horizontalement */
			max-width: 950px; /* Largeur maximale pour contenir les deux sections */
			margin-left: auto; /* Centrage automatique à gauche */
			margin-right: auto; /* Centrage automatique à droite */
		}

		.data-section, .solution-section {
			flex: 1;
			background-color: #ffebee;
			padding: 15px;
			max-width: 350px; /* Conserver la largeur maximale */
			border-radius: 5px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
		}
        
        .solution-section {
            flex: 2;
            background-color: white;
            padding: 15px;
            border-radius: 5px;
			max-width: 500px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .data-item {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .data-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .solution-row {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .solution-select {
            flex: 1;
            padding: 8px;
			max-width: 190px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .solution-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
			max-width: 80px;
			text-align: right;
        }
        
        .solution-formula {
            flex: 1;
            padding: 2px;
            margin-left: 5px;
            color: red;
			font-size: 13px;
            display: none;
        }
        
        .spacer {
            height: 20px;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
			transition: all 0.3s ease;
        }
		button:hover {
			transform: translateY(-5px);
		}        
        #validate-btn {
            background-color: #61b865; /* Vert */
        }
        #validate-btn:hover {
            background-color: #00b50d;
			box-shadow: 0px 0px 10px 5px rgba(0,255,0, 0.6);
        }		
        
        #new-btn {
            background-color: #FFD700; /* Jaune */
            color: white;
        }
        #new-btn:hover {
            background-color: #ffa500;
			box-shadow: 0px 0px 10px 5px rgba(255,255,75, 0.6);			
        }		
        
        #solution-btn {
            background-color: #5eabcc; /* Bleu */
        }
        #solution-btn:hover {
            background-color: #0088c2;
			box-shadow: 0px 0px 10px 5px rgba(120,255,255, 0.6);
        }		
        
        #quit-btn {
            background-color: #ff8585; /* Rouge */
        }
        #quit-btn:hover {
            background-color: #ff0000;
			box-shadow: 0px 0px 10px 5px rgba(255,55,55, 0.6);
		}			
        
        .correct {
            border-color: #4CAF50;
            background-color: #f0fff0;
        }
        
        .incorrect {
            border-color: #FF4500;
            background-color: #fff0f0;
        }
		.info-icon {
			position: absolute;
			top: 15px;
			right: 15px;
			background-color: #51FF46;
			color: black;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			text-align: center;
			line-height: 24px;
			font-weight: bold;
			cursor: pointer;
			font-size: 16px;
			font-style: italic;
			font-family: serif;
			box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
			transition: all 0.3s ease;
		}

		.info-icon:hover {
			background-color: #FDCF00;
			transform: scale(1.1);
		}
		
		.info-icon:hover::after {
			content: "Rappel de la théorie";
			position: absolute;
			top: -30px;
			right: 0;
			background: #333;
			color: white;
			padding: 5px 10px;
			border-radius: 4px;
			font-size: 12px;
			white-space: nowrap;
			font-style: normal;
			font-family: Arial, sans-serif;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
		}

		.modal-content {
			background-color: #3c3c54;
			margin: 5% auto;
			padding: 25px;
			border-radius: 10px;
			width: 80%;
			max-width: 600px;
			border: 3px solid #51FF46;
			box-shadow: 0px 0px 20px rgba(81, 255, 70, 0.5);
			position: relative;
		}

		.close {
			color: #ff4747;
			float: right;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			line-height: 1;
		}

		.close:hover {
			color: #ff0000;
			text-shadow: 0px 0px 10px rgba(255, 0, 0, 0.7);
		}
		
		.theory-title {
			color: #51FF46;
			border-bottom: 2px solid #FDCF00;
			padding-bottom: 10px;
			margin-top: 0;
		}

		.theory-content {
			line-height: 1.6;
			margin-top: 15px;
			color: white;
		}		
    </style>
</head>
<body>
    <div class="header">
        <div class="titre">Le calcul de rendement des immeubles</div>
		<div class="info-icon" onclick="showTheory()">i</div>
    </div>
    <div class="container">
        <div class="data-section">
            <h2>Informations</h2>
            <div id="data-container">
                <!-- Les données seront générées dynamiquement -->
            </div>
        </div>
        
        <div class="solution-section">
            <h2>Réponse</h2>
            <div id="solution-container">
                <!-- Les champs de solution seront générés dynamiquement -->
            </div>
        </div>
    </div>
    
    <div class="buttons">
        <button id="validate-btn">Valider</button>
        <button id="new-btn">Nouvel exercice</button>
        <button id="solution-btn">Afficher la solution</button>
        <button id="quit-btn">Quitter</button>
    </div>

		<!-- Pop-up théorique -->
		<div id="theoryModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeTheory()">&times;</span>
				<h2 class="theory-title">Rappel théorique</h2>
				<div class="theory-content">
					<p><strong>Rendement brut</strong> = Revenus (loyers caissés) x 100 / Prix d'achat de l'immeuble</p>
					<p><strong>Rendement net</strong> = Gain net x 100 / Capital investi</p>
					<p><strong>Capital investi</strong> = Prix d'achat - Dette hypothécaire</p>
					<p><strong>Gain</strong> = Loyers encaissés - toutes les charges, y compris intérêts sur la dette</p>
				</div>
			</div>
		</div>	

    <script>
        // Données de base pour l'exercice
        const exerciseData = {
            "Prix d'achat de l'immeuble": 0,
            "Dette hypothécaire (%)": 0,
            "Taux d'intérêt hypothécaire (%)": 0,
            "Loyers encaissés": 0,
            "Charges d'entretien": 0
        };
        
        // Ordre des éléments dans la solution
        const solutionOrder = [
            "Prix de l'immeuble",
            "Dette hypothécaire",
            "Capital investi",
            "Revenus",
            "- Charges d'entretien",
            "- Intérêts sur la dette",
            "Gain net",
            "Rendement brut (%)",
            "Rendement net (%)"
        ];
        
        // Générer des valeurs aléatoires pour l'exercice
        function generateRandomData() {
            exerciseData["Prix d'achat de l'immeuble"] = (Math.floor(Math.random() * 601) + 400) * 1000;
            exerciseData["Dette hypothécaire (%)"] = (Math.floor(Math.random() * 11) + 30) * 2;
            exerciseData["Taux d'intérêt hypothécaire (%)"] = (Math.floor(Math.random() * 26) + 10) / 10;
            exerciseData["Loyers encaissés"] = Math.round(exerciseData["Prix d'achat de l'immeuble"] * (Math.floor(Math.random() * 51) + 50) / 1000 / 100) * 100;
            exerciseData["Charges d'entretien"] = Math.round(exerciseData["Loyers encaissés"] * (Math.floor(Math.random() * 21) + 30) / 100 / 100) * 100;
        }
        
        // Calculer les résultats basés sur les données
        function calculateResults() {
            const prixImmeuble = exerciseData["Prix d'achat de l'immeuble"];
            const detteHypothecaire = prixImmeuble * exerciseData["Dette hypothécaire (%)"] / 100;
            const capitalInvesti = prixImmeuble - detteHypothecaire;
            const revenus = exerciseData["Loyers encaissés"];
            const chargesEntretien = exerciseData["Charges d'entretien"];
            const interetsDette = Math.round(detteHypothecaire * exerciseData["Taux d'intérêt hypothécaire (%)"] / 100);
            const gainNet = revenus - chargesEntretien - interetsDette;
            const rendementBrut = (revenus / prixImmeuble) * 100;
            const rendementNet = (gainNet / capitalInvesti) * 100;
            
            return {
                "Prix de l'immeuble": prixImmeuble,
                "Dette hypothécaire": detteHypothecaire,
                "Capital investi": capitalInvesti,
                "Revenus": revenus,
                "- Charges d'entretien": chargesEntretien,
                "- Intérêts sur la dette": interetsDette,
                "Gain net": gainNet,
                "Rendement brut (%)": rendementBrut,
                "Rendement net (%)": rendementNet
            };
        }
        
        // Générer les formules avec les valeurs réelles
        function generateFormulasWithValues() {
            const prixImmeuble = exerciseData["Prix d'achat de l'immeuble"];
            const dettePourcentage = exerciseData["Dette hypothécaire (%)"];
            const tauxInteret = exerciseData["Taux d'intérêt hypothécaire (%)"];
            const loyers = exerciseData["Loyers encaissés"];
            const charges = exerciseData["Charges d'entretien"];
            
            const detteHypothecaire = prixImmeuble * dettePourcentage / 100;
            const capitalInvesti = prixImmeuble - detteHypothecaire;
            const interetsDette = Math.round(detteHypothecaire * tauxInteret / 100);
            const gainNet = loyers - charges - interetsDette;
            const rendementBrut = (loyers / prixImmeuble) * 100;
            const rendementNet = (gainNet / capitalInvesti) * 100;
            
            return {
                "Prix de l'immeuble": `${prixImmeuble.toLocaleString('fr-FR')}`,
                "Dette hypothécaire": `${detteHypothecaire.toLocaleString('fr-FR')} = ${prixImmeuble.toLocaleString('fr-FR')} × ${dettePourcentage}% / 100`,
                "Capital investi": `${capitalInvesti.toLocaleString('fr-FR')} = ${prixImmeuble.toLocaleString('fr-FR')} - ${detteHypothecaire.toLocaleString('fr-FR')}`,
                "Revenus": `${loyers.toLocaleString('fr-FR')} (loyers encaissés)`,
                "- Charges d'entretien": `${charges.toLocaleString('fr-FR')}`,
                "- Intérêts sur la dette": `${interetsDette.toLocaleString('fr-FR')} = ${detteHypothecaire.toLocaleString('fr-FR')} × ${tauxInteret}% / 100`,
                "Gain net": `${gainNet.toLocaleString('fr-FR')} = ${loyers.toLocaleString('fr-FR')} - ${charges.toLocaleString('fr-FR')} - ${interetsDette.toLocaleString('fr-FR')}`,
                "Rendement brut (%)": `${rendementBrut.toFixed(2)} % = ${loyers.toLocaleString('fr-FR')} / ${prixImmeuble.toLocaleString('fr-FR')} × 100`,
                "Rendement net (%)": `${rendementNet.toFixed(2)} % = ${gainNet.toLocaleString('fr-FR')} / ${capitalInvesti.toLocaleString('fr-FR')} × 100`
            };
        }
        
        // Afficher les données de l'exercice
        function displayData() {
            const dataContainer = document.getElementById('data-container');
            dataContainer.innerHTML = '';
            
            for (const [key, value] of Object.entries(exerciseData)) {
                const dataItem = document.createElement('div');
                dataItem.className = 'data-item';
                
                const label = document.createElement('div');
                label.className = 'data-label';
                label.textContent = key;
                
                const valueDiv = document.createElement('div');
                // Formatage des nombres avec séparateurs de milliers
                if (key.includes('%')) {
                    valueDiv.textContent = value.toLocaleString('fr-FR', {minimumFractionDigits: 1, maximumFractionDigits: 1}) + (key.includes('%') ? ' %' : '');
                } else {
                    valueDiv.textContent = value.toLocaleString('fr-FR') + ' CHF';
                }
                
                dataItem.appendChild(label);
                dataItem.appendChild(valueDiv);
                dataContainer.appendChild(dataItem);
            }
        }
        
        // Mélanger un tableau (algorithme de Fisher-Yates)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Afficher les champs de solution
        function displaySolutionFields() {
            const solutionContainer = document.getElementById('solution-container');
            solutionContainer.innerHTML = '';
            
            // Mélanger les options pour les listes déroulantes
            const shuffledOptions = shuffleArray([...solutionOrder]);
            const options = shuffledOptions.map(item => `<option value="${item}">${item}</option>`).join('');
            
            // Ajouter les lignes de solution
            for (let i = 0; i < solutionOrder.length; i++) {
                const solutionRow = document.createElement('div');
                solutionRow.className = 'solution-row';
                
                // Liste déroulante
                const select = document.createElement('select');
                select.className = 'solution-select';
                select.innerHTML = `<option value="">Sélectionner une rubrique</option>${options}`;
                
                // Champ de saisie
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'solution-input';
                input.placeholder = 'Montant';
                
                // Formule (cachée par défaut)
                const formula = document.createElement('div');
                formula.className = 'solution-formula';
                formula.id = `formula-${i}`;
                
                solutionRow.appendChild(select);
                solutionRow.appendChild(input);
                solutionRow.appendChild(formula);
                solutionContainer.appendChild(solutionRow);
                
                // Ajouter des espaces après la 3ème et 6ème ligne
                if (i === 2 || i === 6) {
                    const spacer = document.createElement('div');
                    spacer.className = 'spacer';
                    solutionContainer.appendChild(spacer);
                }
            }
        }
        
        // Valider les réponses
        function validateAnswers() {
            const correctResults = calculateResults();
            const inputs = document.querySelectorAll('.solution-input');
            const selects = document.querySelectorAll('.solution-select');
            
            let correctCount = 0;
            let totalCount = 0;
            
            for (let i = 0; i < selects.length; i++) {
                const selectedOption = selects[i].value;
                const inputValue = parseFloat(inputs[i].value.replace(/\s/g, '').replace(',', '.').replace('%', ''));
                
                if (selectedOption && !isNaN(inputValue)) {
                    totalCount++;
                    
                    const correctValue = correctResults[selectedOption];
                    const tolerance = Math.abs(correctValue) * 0.01; // 1% de tolérance
                    
                    if (Math.abs(inputValue - correctValue) <= tolerance) {
                        inputs[i].classList.remove('incorrect');
                        inputs[i].classList.add('correct');
                        correctCount++;
                    } else {
                        inputs[i].classList.remove('correct');
                        inputs[i].classList.add('incorrect');
                    }
                }
            }
            
            alert(`Vous avez ${correctCount} réponse(s) correcte(s) sur ${totalCount}.\nVous pouvez réviser vos chiffres et revalider ou afficher la solution.`);
        }
        
        // Afficher la solution
        function showSolution() {
            const correctResults = calculateResults();
            const formulasWithValues = generateFormulasWithValues();
            const inputs = document.querySelectorAll('.solution-input');
            const selects = document.querySelectorAll('.solution-select');
            const formulaDivs = document.querySelectorAll('.solution-formula');
            
            // Créer une liste des étiquettes déjà sélectionnées
            const selectedLabels = new Set();
            for (let i = 0; i < selects.length; i++) {
                if (selects[i].value) {
                    selectedLabels.add(selects[i].value);
                }
            }
            
            // Créer une liste des étiquettes manquantes dans l'ordre correct
            const missingLabels = solutionOrder.filter(label => !selectedLabels.has(label));
            
            // Remplir les réponses
            for (let i = 0; i < selects.length; i++) {
                const formulaDiv = formulaDivs[i];
                const select = selects[i];
                const input = inputs[i];
                
                // Afficher la formule
                formulaDiv.style.display = 'block';
                
                let labelToFill;
                if (select.value) {
                    // Si une étiquette est déjà sélectionnée, utiliser celle-ci
                    labelToFill = select.value;
                } else if (missingLabels.length > 0) {
                    // Sinon, prendre la première étiquette manquante
                    labelToFill = missingLabels.shift();
                    // Mettre à jour la sélection
                    select.value = labelToFill;
                }
                
                if (labelToFill) {
                    const correctValue = correctResults[labelToFill];
                    // Formatage selon le type de valeur
                    if (labelToFill.includes('%')) {
                        input.value = correctValue.toFixed(2) + ' %';
                    } else {
                        input.value = correctValue.toLocaleString('fr-FR') + ' CHF';
                    }
                    
                    // Afficher la formule avec les valeurs réelles
                    formulaDiv.textContent = formulasWithValues[labelToFill];
                    input.classList.add('correct');
                }
            }
        }
        
        // Nouvel exercice
        function newExercise() {
            generateRandomData();
            displayData();
            displaySolutionFields();
        }
        
        // Quitter l'application
        function quitApp() {
            
                window.close();
            
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            generateRandomData();
            displayData();
            displaySolutionFields();
            
            // Événements des boutons
            document.getElementById('validate-btn').addEventListener('click', validateAnswers);
            document.getElementById('new-btn').addEventListener('click', newExercise);
            document.getElementById('solution-btn').addEventListener('click', showSolution);
            document.getElementById('quit-btn').addEventListener('click', quitApp);
        });
		// Fonctions pour le pop-up théorique
		function showTheory() {
			document.getElementById('theoryModal').style.display = 'block';
		}

		function closeTheory() {
			document.getElementById('theoryModal').style.display = 'none';
		}

		// Fermer le pop-up si on clique en dehors
		window.onclick = function(event) {
			const modal = document.getElementById('theoryModal');
			if (event.target === modal) {
				closeTheory();
			}
		}		
    </script>
</body>
</html>