<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journalisation - Exercice de Comptabilité</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #333;
        }
        header, footer {
            text-align: center;
            padding: 0px  10px;
			margin: 0 auto 30px auto; /* Centrage horizontal */
			max-width: 1220px;
            background-color: #78004f;
			text-shadow: 2px 2px 4px rgba(0,0,0,1);
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
            border-top: 5px solid yellow;
            border-bottom: 5px solid blue;
        }
        footer {
            margin-top: 20px;
            font-style: italic;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 20px;
            border-bottom: 6px solid #3498db;
		}
        h1 {
            color: #FFFFFF;
            margin-top: 0px;
			margin-bottom: 5px;
        }
        h2 {
            color: #fedbff;
            margin-top: 0px;
			margin-bottom: 0px;
        }
        h3 {
            color: #000000;
            margin-top: 0px;
			margin-bottom: 0px;
        }
		 h4 {
            color: #ffffff;
            margin-top: 0px;
			margin-bottom: 0px;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #e2ecf8;
			text-align: center;
        }
        
        /* Modifications pour les colonnes de montant */
        th:nth-child(3), th:nth-child(4),
        td:nth-child(3), td:nth-child(4) {
            width: 120px;  /* Largeur réduite pour les colonnes de montant */
        }
        
        /* Alignement à droite pour les montants */
        .debit-amount, .credit-amount {
            text-align: right;
        }
        
        /* Alignement à droite pour les cellules de montant */
        td:nth-child(3), td:nth-child(4) {
            text-align: right;
        }
        
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input {
            width: 90%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
        }
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
			margin-left: 15px;
            transition: all 0.3s ease;
			text-shadow: 1px 1px 2px rgba(0,0,0,1);
            box-shadow: 4px 4px 6px rgba(0,0,0,0.5);			
		}
        button:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 8px rgba(0,0,0,0.5);			
		}		
        #validate-btn {
            background-color: #61b865;
            color: white;
        }
        #validate-btn:hover {
            background-color: #00b50d;
        }		
        #next-btn {
            background-color: #ffbf47;
            color: white;
        }
		#next-btn:hover {
            background-color: #ffa500;
        }
        #add-line-btn {
            background-color: #037DFF;
			color: white;
        }
        #add-line-btn:hover {
            background-color: #045BB5;
        }	
        #quit-btn {
            background-color: #ff4747;
            color: white;
        }
        #quit-btn:hover {
            background-color: #ff0000;
        }		
        #restart-btn {
            background-color: #9b59b6;
            color: white;
            display: none;
            margin: 20px auto;
        }
		#restart-btn:hover {
            background-color: #6D3D80;
        }		
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .solution-table {
            margin-top: 20px;
            display: none;
        }
		.entry-description {
			margin-bottom: 20px;
			padding: 10px;
			background-color: #e8f4fc;
			border-left: 4px solid #3498db;
			white-space: pre-wrap; /* Ajouter cette ligne */
			font-family: 'Courier New', monospace; /* Police à chasse fixe */
			line-height: 1.2;
		}
        .completion-message {
            text-align: center;
            padding: 30px;
            background-color: #e8f4fc;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h2>Journalisation avec écritures multiples</h2>
		<h1>Les salaires</h1>
    </header>


    <div class="container">
        <div class="stats">
            <div id="remaining">Écritures restantes: 0</div>
			<div id="score">Score: 0/${accountingEntries.length}</div>
        </div>

        <div class="entry-description" id="entry-description"></div>


        <form id="accounting-form">
            <table id="entries-table">
                <thead>
                    <tr>
                        <th>Comptes débités</th>
                        <th>Comptes crédités</th>
                        <th>Montant débité</th>
                        <th>Montant crédité</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <select class="debit-account">
                                <option value="">Sélectionner un compte</option>
                                <optgroup label="ACTIF">
                                    <option value="Caisse">Caisse</option>
                                    <option value="Poste">Poste</option>
									<option value="Banque">Banque</option>
									<option value="Créances clients">Créances clients</option>
									<option value="Avances de salaires">Avances de salaires</option>
									<option value="Stock de marchandises">Stock de marchandises</option>
									<option value="Véhicules">Véhicules</option>
                                    </optgroup>
                                <optgroup label="PASSIF">
                                    <option value="Dettes fournisseurs">Dettes fournisseurs</option>
									<option value="Autres dettes">Autres dettes</option>
									<option value="Dettes AVS">Dettes AVS</option>
									<option value="Dettes LPP">Dettes LPP</option>
									<option value="Dettes caisse ALFA">Dettes caisse ALFA</option>
									<option value="Capital">Capital</option>
									<option value="Privé">Privé</option>
                                </optgroup>
                                <optgroup label="MARCHANDISES">
                                    <option value="Ventes de marchandises">Ventes de marchandises</option>
									<option value="Achats de marchandises">Achats de marchandises</option>
									<option value="Prestations propres">Prestations propres</option>
                                </optgroup>
                                <optgroup label="CHARGES ET PRODUITS">
                                    <option value="Salaires">Salaires</option>
									<option value="Charges sociales">Charges sociales</option>
                                    <option value="Loyers">Loyers</option>
									<option value="Assurances">Assurances</option>
									<option value="Electricité">Electricité</option>
									<option value="Frais de véhicules">Frais de véhicules</option>
									<option value="Frais d'administration">Frais d'administration</option>
									<option value="ACE">ACE</option>
									<option value="Produits financiers">Produits financiers</option>
                                </optgroup>
                            </select>
                            </select>
                        </td>
                        <td>
                            <select class="credit-account">
                                <option value="">Sélectionner un compte</option>
                                <optgroup label="ACTIF">
                                    <option value="Caisse">Caisse</option>
                                    <option value="Poste">Poste</option>
									<option value="Banque">Banque</option>
									<option value="Créances clients">Créances clients</option>
									<option value="Avances de salaires">Avances de salaires</option>
									<option value="Stock de marchandises">Stock de marchandises</option>
									<option value="Véhicules">Véhicules</option>
                                    </optgroup>
                                <optgroup label="PASSIF">
                                    <option value="Dettes fournisseurs">Dettes fournisseurs</option>
									<option value="Autres dettes">Autres dettes</option>
									<option value="Dettes AVS">Dettes AVS</option>
									<option value="Dettes LPP">Dettes LPP</option>
									<option value="Dettes caisse ALFA">Dettes caisse ALFA</option>
									<option value="Capital">Capital</option>
									<option value="Privé">Privé</option>
                                </optgroup>
                                <optgroup label="MARCHANDISES">
                                    <option value="Ventes de marchandises">Ventes de marchandises</option>
									<option value="Achats de marchandises">Achats de marchandises</option>
									<option value="Prestations propres">Prestations propres</option>
                                </optgroup>
                                <optgroup label="CHARGES ET PRODUITS">
                                    <option value="Salaires">Salaires</option>
									<option value="Charges sociales">Charges sociales</option>
                                    <option value="Loyers">Loyers</option>
									<option value="Assurances">Assurances</option>
									<option value="Electricité">Electricité</option>
									<option value="Frais de véhicules">Frais de véhicules</option>
									<option value="Frais d'administration">Frais d'administration</option>
									<option value="ACE">ACE</option>
									<option value="Produits financiers">Produits financiers</option>
                                </optgroup>
                            </select>
                            </select>
                        </td>
                        <td><input type="number" class="debit-amount" min="0" step="0.01" style="text-align: right;"></td>
                        <td><input type="number" class="credit-amount" min="0" step="0.01" style="text-align: right;"></td>
                    </tr>
                </tbody>
            </table>
        </form>

        <div class="buttons">
            <button id="add-line-btn" type="button">Ajouter une ligne</button>
            <div>
                <button id="validate-btn" type="button">Valider</button>
                <button id="next-btn" type="button" disabled>Ecriture suivante</button>
				<button id="quit-btn" onclick="window.close()">Quitter</button>
            </div>
        </div>

        <div id="feedback" class="feedback"></div>

        <table id="solution-table" class="solution-table">
            <thead>
                <tr>
                    <th>Comptes débités</th>
                    <th>Comptes crédités</th>
                    <th>Montant débité</th>
                    <th>Montant crédité</th>
                </tr>
            </thead>
            <tbody>
                <!-- La solution sera affichée ici -->
            </tbody>
        </table>

        <div id="completion-message" class="completion-message">
            <h3>Félicitations ! Vous avez terminé toutes les écritures.</h3>
            <p>A vous de juger votre score : <span id="final-score">0</span></p>
			<h3>N'oubliez pas : "Je fais de la compta et c'est ma joie"</h3>


        <button id="restart-btn" type="button">Recommencer</button>
    </div>


    <script>
		document.addEventListener('keydown', function(e) {
			if (e.keyCode == 123 || // F12
				(e.ctrlKey && e.shiftKey && e.keyCode == 73) || // Ctrl+Shift+I
				(e.ctrlKey && e.keyCode == 85)) { // Ctrl+U
				e.preventDefault();
			}
		});
		
        // Données des écritures comptables
        let accountingEntries = [

            {
                description: "Un employé demande une avance de salaire de CHF 500.-. Nous la lui versons en espèces.",
                solution: [
					{ debit: "Avances de salaires", credit: "Caisse", amount: 500  }
                ]
            },
			{
                description: "Tenir compte d'un salaire de CHF 7'000.- pour le patron de l'entreprise.",
                solution: [
                    { debit: "Salaires", credit: "Privé", amount: 7000 }
                ]
            },
			{
                description: "Comptabiliser la cotisation AVS du patron, CHF 300.-.",
                solution: [
					{ debit: "Privé", credit: "Dettes AVS", amount: 300 }
                ]
            },
			{
                description: "Versement par banque du salaire de l'employée.\nSalaire brut :\t2'000.-\nDéductions :\n- AVS\t\t  150.-\n- LPP\t\t  200.-\n- LAA-AANP\t   60.-\nSalaire net :\t1'590.-",
                solution: [
                    { debit: "Salaires", credit: "", amount: 2000 },
					{ debit: "", credit: "Dettes AVS", amount: 150 },
					{ debit: "", credit: "Dettes LPP", amount: 200 },
					{ debit: "", credit: "Charges sociales", amount: 60 },
					{ debit: "", credit: "Banque", amount: 1590 }
                ]
            },
			{
                description: "Comptabilisation du montant dû à l'assurance accident pour l'année à venir, CHF 600.-.",
                solution: [
					{ debit: "Charges sociales", credit: "Autres dettes", amount: 600 }
                ]
            },
			{
                description: "Comptabilisation de la part patronale aux assurances sociales :\nAVS\t\t\tCHF   800.-\nLPP\t\t\tCHF 1'200.-\nCaisse ALFA\t\tCHF   500.-\nTotal :\t\t\tCHF 2'500.-",
                solution: [
                    { debit: "Charges sociales", credit: "", amount: 2500 },
					{ debit: "", credit: "Dettes AVS", amount: 800 },
					{ debit: "", credit: "Dettes LPP", amount: 1200 },
					{ debit: "", credit: "Dettes caisse ALFA", amount: 500 }
                ]
            },
			{
                description: "Nous avons versé CHF 800.- d'allocations familiales à nos employés. Les cotisations comptabilisées s'élèvent à CHF 1'000.-. Nous payons par banque le montant dû.",
                solution: [
					{ debit: "Dettes caisse ALFA", credit: "Banque", amount: 200  }
                ]
            },
			{
                description: "Versement par banque du salaire du mois.\nSalaire brut :\t\t4'000.-\nAllocations familiales\t  250.-\nDéductions :\n- AVS\t\t\t  400.-\n- LPP\t\t\t  600.-\n- LAA-AANP\t\t  120.-\nSalaire net :\t\tà calculer",
                solution: [
                    { debit: "Salaires", credit: "", amount: 4000 },
					{ debit: "Dettes caisse ALFA", credit: "", amount: 250 },
					{ debit: "", credit: "Dettes AVS", amount: 400 },
					{ debit: "", credit: "Dettes LPP", amount: 600 },
					{ debit: "", credit: "Charges sociales", amount: 120 },
					{ debit: "", credit: "Banque", amount: 3130 }
                ]
            },
			{
                description: "Versement par banque du salaire du mois de Fernand, notre chef mécano.\nSalaire brut :\t\t9'300.-\nAllocations familiales\t  480.-\nDéductions :\n- AVS/AI/APG\t\t  490.-\n- AC\t\t\t  100.-\n- LPP\t\t\t  700.-\n- LAA-AANP\t\t  110.-\n- Avance de salaire\t1'200.-\nSalaire net :\t\t7'180.-",
                solution: [
                    { debit: "Salaires", credit: "", amount: 9300 },
					{ debit: "Dettes caisse ALFA", credit: "", amount: 480 },
					{ debit: "", credit: "Dettes AVS", amount: 590 },
					{ debit: "", credit: "Dettes LPP", amount: 700 },
					{ debit: "", credit: "Charges sociales", amount: 110 },
					{ debit: "", credit: "Avances de salaires", amount: 1200 },
					{ debit: "", credit: "Banque", amount: 7180 }
                ]
            },
			{
                description: "Comptabiliser une cotisation volontaire à une caisse de pension du patron, CHF 8'000.-.",
                solution: [
					{ debit: "Privé", credit: "Dettes LPP", amount: 8000 }
                ]
            },
			{
                description: "Les APG nous rembourse par poste le salaire de CHF 4'200.- que nous avions versé à notre employé au service militaire.",
                solution: [
					{ debit: "Poste", credit: "Salaires", amount: 4200 }
                ]
            },
			{
                description: "Nous payons par banque la facture de l'assurance accident pour l'année, CHF 6'000.-.",
                solution: [
					{ debit: "Autres dettes", credit: "Banque", amount: 6000 }
                ]
            },
			{
                description: "Nous payons par banque l'assurance RC de l'entreprise, CHF 4'000.-.",
                solution: [
					{ debit: "Assurances", credit: "Banque", amount: 4000 }
                ]
            }
	
            /* Ajouter d'autres écritures ici par la suite
			,
			{
                description: "",
                solution: [
                    { debit: "", credit: "", amount:  },
					{ debit: "", credit: "", amount:   }
                ]
            }
			*/
			
			
        ];

        // Mélanger aléatoirement le tableau des écritures une seule fois au début
        accountingEntries = accountingEntries.sort(() => Math.random() - 0.5);
        
        // Variables d'état
        let currentEntryIndex = 0;
        let remainingEntries = accountingEntries.length;
        let score = 0;
        let isValidationDone = false;

        // Éléments DOM
        const entryDescription = document.getElementById('entry-description');
        const entriesTable = document.getElementById('entries-table');
        const validateBtn = document.getElementById('validate-btn');
        const nextBtn = document.getElementById('next-btn');
        const addLineBtn = document.getElementById('add-line-btn');
        const feedback = document.getElementById('feedback');
        const solutionTable = document.getElementById('solution-table');
        const remainingSpan = document.getElementById('remaining');
        const scoreSpan = document.getElementById('score');
        const completionMessage = document.getElementById('completion-message');
        const finalScoreSpan = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');

        // Initialiser l'application
        function init() {
            updateStats();
            loadEntry(currentEntryIndex);
        }

        // Mettre à jour les statistiques
        function updateStats() {
            remainingSpan.textContent = `Écritures restantes: ${remainingEntries}`;
            scoreSpan.textContent = `Score: ${score}/${accountingEntries.length}`;
        }

        // Charger une écriture
        function loadEntry(index) {
            if (index >= accountingEntries.length) {
                // Toutes les écritures ont été traitées
                showCompletionMessage();
                return;
            }

            const entry = accountingEntries[index];
            entryDescription.textContent = entry.description;
            
            // Réinitialiser le formulaire
            const tbody = entriesTable.querySelector('tbody');
            tbody.innerHTML = '';
            addNewLine();
            
            // Cacher la solution et le feedback
            feedback.style.display = 'none';
            solutionTable.style.display = 'none';
            
            // Réactiver les boutons
            validateBtn.disabled = false;
            nextBtn.disabled = true;
            isValidationDone = false;
        }

        // Afficher le message de fin avec le score final
        function showCompletionMessage() {
            // Cacher les éléments d'interface
            entriesTable.style.display = 'none';
            validateBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            addLineBtn.style.display = 'none';
            entryDescription.style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            // Afficher le message de fin
            finalScoreSpan.textContent = `${score}/${accountingEntries.length}`;
            completionMessage.style.display = 'block';
            restartBtn.style.display = 'block';
        }
		
// Marquer les cellules incorrectes en rouge
function markIncorrectCells(userEntries, correctSolution) {
    const rows = entriesTable.querySelectorAll('tbody tr');
    
    // Réinitialiser toutes les couleurs d'abord
    rows.forEach(row => {
        row.querySelector('.debit-account').style.backgroundColor = '';
        row.querySelector('.credit-account').style.backgroundColor = '';
        row.querySelector('.debit-amount').style.backgroundColor = '';
        row.querySelector('.credit-amount').style.backgroundColor = '';
    });
    
    // Créer une copie des entrées utilisateur pour les marquer au fur et à mesure
    const userEntriesToCheck = [...userEntries];
    const correctEntries = [];
    
    // Convertir la solution correcte en format comparable
    correctSolution.forEach(entry => {
        if (entry.debit) {
            correctEntries.push({
                account: entry.debit,
                type: 'debit',
                amount: entry.amount
            });
        }
        if (entry.credit) {
            correctEntries.push({
                account: entry.credit,
                type: 'credit',
                amount: entry.amount
            });
        }
    });
    
    // Première passe : marquer les entrées correctes
    const correctUserEntries = [];
    
    correctEntries.forEach(correctEntry => {
        const userEntryIndex = userEntriesToCheck.findIndex(userEntry => 
            userEntry.account === correctEntry.account && 
            userEntry.type === correctEntry.type && 
            userEntry.amount === correctEntry.amount
        );
        
        if (userEntryIndex !== -1) {
            correctUserEntries.push(userEntriesToCheck[userEntryIndex]);
            userEntriesToCheck.splice(userEntryIndex, 1);
        }
    });
    
    // Deuxième passe : marquer les entrées incorrectes restantes
    userEntriesToCheck.forEach(incorrectEntry => {
        // Trouver la ligne où se trouve cette entrée incorrecte
        let found = false;
        
        for (let i = 0; i < rows.length && !found; i++) {
            const row = rows[i];
            const debitAccount = row.querySelector('.debit-account').value;
            const creditAccount = row.querySelector('.credit-account').value;
            const debitAmount = parseFloat(row.querySelector('.debit-amount').value) || 0;
            const creditAmount = parseFloat(row.querySelector('.credit-amount').value) || 0;
            
            if (incorrectEntry.type === 'debit' && 
                debitAccount === incorrectEntry.account && 
                debitAmount === incorrectEntry.amount) {
                
                row.querySelector('.debit-account').style.backgroundColor = '#ffcccc';
                row.querySelector('.debit-amount').style.backgroundColor = '#ffcccc';
                found = true;
            }
            else if (incorrectEntry.type === 'credit' && 
                     creditAccount === incorrectEntry.account && 
                     creditAmount === incorrectEntry.amount) {
                
                row.querySelector('.credit-account').style.backgroundColor = '#ffcccc';
                row.querySelector('.credit-amount').style.backgroundColor = '#ffcccc';
                found = true;
            }
        }
    });
    
    // Troisième passe : vérifier les entrées manquantes (dans la solution mais pas chez l'utilisateur)
    const missingEntries = [];
    const userEntriesCopy = [...userEntries];
    
    correctEntries.forEach(correctEntry => {
        const exists = userEntriesCopy.some(userEntry => 
            userEntry.account === correctEntry.account && 
            userEntry.type === correctEntry.type && 
            userEntry.amount === correctEntry.amount
        );
        
        if (!exists) {
            missingEntries.push(correctEntry);
        }
    });
    

}	

        // Réinitialiser le jeu
        function restartGame() {
            // Réinitialiser les variables d'état
            currentEntryIndex = 0;
            remainingEntries = accountingEntries.length;
            score = 0;
            
            // Réafficher les éléments cachés
            entriesTable.style.display = 'table';
            validateBtn.style.display = 'block';
            nextBtn.style.display = 'block';
            addLineBtn.style.display = 'block';
            entryDescription.style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            
            // Cacher le message de fin et le bouton recommencer
            completionMessage.style.display = 'none';
            restartBtn.style.display = 'none';
            
            // Réinitialiser l'interface
            updateStats();
            loadEntry(currentEntryIndex);
        }

        // Ajouter une nouvelle ligne au formulaire
        function addNewLine() {
            const tbody = entriesTable.querySelector('tbody');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                        <td>
                            <select class="debit-account">
                                <option value=""></option>
                                <optgroup label="ACTIF">
                                    <option value="Caisse">Caisse</option>
                                    <option value="Poste">Poste</option>
									<option value="Banque">Banque</option>
									<option value="Créances clients">Créances clients</option>
									<option value="Avances de salaires">Avances de salaires</option>
									<option value="Stock de marchandises">Stock de marchandises</option>
									<option value="Véhicules">Véhicules</option>
                                    </optgroup>
                                <optgroup label="PASSIF">
                                    <option value="Dettes fournisseurs">Dettes fournisseurs</option>
									<option value="Autres dettes">Autres dettes</option>
									<option value="Dettes AVS">Dettes AVS</option>
									<option value="Dettes LPP">Dettes LPP</option>
									<option value="Dettes caisse ALFA">Dettes caisse ALFA</option>
									<option value="Capital">Capital</option>
									<option value="Privé">Privé</option>
                                </optgroup>
                                <optgroup label="MARCHANDISES">
                                    <option value="Ventes de marchandises">Ventes de marchandises</option>
									<option value="Achats de marchandises">Achats de marchandises</option>
									<option value="Prestations propres">Prestations propres</option>
                                </optgroup>
                                <optgroup label="CHARGES ET PRODUITS">
                                    <option value="Salaires">Salaires</option>
									<option value="Charges sociales">Charges sociales</option>
                                    <option value="Loyers">Loyers</option>
									<option value="Assurances">Assurances</option>
									<option value="Electricité">Electricité</option>
									<option value="Frais de véhicules">Frais de véhicules</option>
									<option value="Frais d'administration">Frais d'administration</option>
									<option value="ACE">ACE</option>
									<option value="Produits financiers">Produits financiers</option>
                                </optgroup>
                            </select>
                            </select>
                        </td>
                        <td>
                            <select class="credit-account">
                                <option value=""></option>
                                <optgroup label="ACTIF">
                                    <option value="Caisse">Caisse</option>
                                    <option value="Poste">Poste</option>
									<option value="Banque">Banque</option>
									<option value="Créances clients">Créances clients</option>
									<option value="Avances de salaires">Avances de salaires</option>
									<option value="Stock de marchandises">Stock de marchandises</option>
									<option value="Véhicules">Véhicules</option>
                                    </optgroup>
                                <optgroup label="PASSIF">
                                    <option value="Dettes fournisseurs">Dettes fournisseurs</option>
									<option value="Autres dettes">Autres dettes</option>
									<option value="Dettes AVS">Dettes AVS</option>
									<option value="Dettes LPP">Dettes LPP</option>
									<option value="Dettes caisse ALFA">Dettes caisse ALFA</option>
									<option value="Capital">Capital</option>
									<option value="Privé">Privé</option>
                                </optgroup>
                                <optgroup label="MARCHANDISES">
                                    <option value="Ventes de marchandises">Ventes de marchandises</option>
									<option value="Achats de marchandises">Achats de marchandises</option>
									<option value="Prestations propres">Prestations propres</option>
                                </optgroup>
                                <optgroup label="CHARGES ET PRODUITS">
                                    <option value="Salaires">Salaires</option>
									<option value="Charges sociales">Charges sociales</option>
                                    <option value="Loyers">Loyers</option>
									<option value="Assurances">Assurances</option>
									<option value="Electricité">Electricité</option>
									<option value="Frais de véhicules">Frais de véhicules</option>
									<option value="Frais d'administration">Frais d'administration</option>
									<option value="ACE">ACE</option>
									<option value="Produits financiers">Produits financiers</option>
                                </optgroup>
                            </select>
                            </select>
                        </td>
                <td><input type="number" class="debit-amount" min="0" step="100" style="text-align: right;"></td>
                <td><input type="number" class="credit-amount" min="0" step="100" style="text-align: right;"></td>
            `;
            
            tbody.appendChild(newRow);
			
		    // Focus sur la liste déroulante de gauche de la nouvelle ligne
			const newDebitAccount = newRow.querySelector('.debit-account');
			newDebitAccount.focus();	
	
        }

        // Valider la réponse
		function validateAnswer() {
			if (isValidationDone) return;
    
			const userEntries = getUserEntries();
			const correctSolution = accountingEntries[currentEntryIndex].solution;
    
    // Vérifier si la réponse est correcte
    const isCorrect = checkSolution(userEntries, correctSolution);
    
    if (isCorrect) {
        feedback.textContent = "Bravo ! Votre réponse est correcte.";
        feedback.className = "feedback correct";
        score++;
    } else {
        feedback.textContent = "Voici la bonne réponse :";
        feedback.className = "feedback incorrect";
        showSolution(correctSolution);
        
        // Marquer les cellules incorrectes en rouge
        markIncorrectCells(userEntries, correctSolution);
    }
    
    feedback.style.display = 'block';
    validateBtn.disabled = true;
    nextBtn.disabled = false;
    isValidationDone = true;
    remainingEntries--;
    updateStats();
}

        // Obtenir les entrées de l'utilisateur
        function getUserEntries() {
            const rows = entriesTable.querySelectorAll('tbody tr');
            const entries = [];
            
            rows.forEach(row => {
                const debitAccount = row.querySelector('.debit-account').value;
                const creditAccount = row.querySelector('.credit-account').value;
                const debitAmount = parseFloat(row.querySelector('.debit-amount').value) || 0;
                const creditAmount = parseFloat(row.querySelector('.credit-amount').value) || 0;
                
                if (debitAccount && debitAmount > 0) {
                    entries.push({
                        account: debitAccount,
                        type: 'debit',
                        amount: debitAmount
                    });
                }
                
                if (creditAccount && creditAmount > 0) {
                    entries.push({
                        account: creditAccount,
                        type: 'credit',
                        amount: creditAmount
                    });
                }
            });
            
            return entries;
        }

        // Vérifier si la solution est correcte
        function checkSolution(userEntries, correctSolution) {
            // Vérifier le total débit et crédit
            let userDebitTotal = 0;
            let userCreditTotal = 0;
            let correctDebitTotal = 0;
            let correctCreditTotal = 0;
            
            userEntries.forEach(entry => {
                if (entry.type === 'debit') userDebitTotal += entry.amount;
                else userCreditTotal += entry.amount;
            });
            
            correctSolution.forEach(entry => {
                if (entry.debit) correctDebitTotal += entry.amount;
                if (entry.credit) correctCreditTotal += entry.amount;
            });
            
            if (userDebitTotal !== correctDebitTotal || userCreditTotal !== correctCreditTotal) {
                return false;
            }
            
            // Vérifier que tous les comptes et montants correspondent
            const userEntriesByAccount = {};
            userEntries.forEach(entry => {
                if (!userEntriesByAccount[entry.account]) {
                    userEntriesByAccount[entry.account] = {
                        debit: 0,
                        credit: 0
                    };
                }
                
                if (entry.type === 'debit') {
                    userEntriesByAccount[entry.account].debit += entry.amount;
                } else {
                    userEntriesByAccount[entry.account].credit += entry.amount;
                }
            });
            
            const correctEntriesByAccount = {};
            correctSolution.forEach(entry => {
                if (entry.debit) {
                    if (!correctEntriesByAccount[entry.debit]) {
                        correctEntriesByAccount[entry.debit] = {
                            debit: 0,
                            credit: 0
                        };
                    }
                    correctEntriesByAccount[entry.debit].debit += entry.amount;
                }
                
                if (entry.credit) {
                    if (!correctEntriesByAccount[entry.credit]) {
                        correctEntriesByAccount[entry.credit] = {
                            debit: 0,
                            credit: 0
                        };
                    }
                    correctEntriesByAccount[entry.credit].credit += entry.amount;
                }
            });
            
            // Vérifier que tous les comptes ont les mêmes montants
            for (const account in correctEntriesByAccount) {
                if (!userEntriesByAccount[account] || 
                    userEntriesByAccount[account].debit !== correctEntriesByAccount[account].debit ||
                    userEntriesByAccount[account].credit !== correctEntriesByAccount[account].credit) {
                    return false;
                }
            }
            
            // Vérifier qu'il n'y a pas de comptes supplémentaires
            for (const account in userEntriesByAccount) {
                if (!correctEntriesByAccount[account]) {
                    return false;
                }
            }
            
            return true;
        }

        // Afficher la solution correcte
		function showSolution(solution) {
			const tbody = solutionTable.querySelector('tbody');
			tbody.innerHTML = '';
    
			solution.forEach(entry => {
				const row = document.createElement('tr');
        
        row.innerHTML = `
            <td>${entry.debit || ''}</td>
            <td>${entry.credit || ''}</td>
            <td style="text-align: right;">${entry.debit ? formatAmount(entry.amount) : ''}</td>
            <td style="text-align: right;">${entry.credit ? formatAmount(entry.amount) : ''}</td>
        `;
        
        tbody.appendChild(row);
    });
    
    solutionTable.style.display = 'table';
}

	// Formater le montant avec apostrophe
		function formatAmount(amount) {
			const num = typeof amount === 'number' ? amount : parseFloat(amount);
			const parts = num.toFixed(2).split('.');
			let integerPart = parts[0];
			const decimalPart = parts[1];
    
			integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, "'");
    
			return `${integerPart}.${decimalPart}`;
		}

        // Passer à l'écriture suivante
        function nextEntry() {
            currentEntryIndex++;
            loadEntry(currentEntryIndex);
        }

        // Événements
        validateBtn.addEventListener('click', validateAnswer);
        nextBtn.addEventListener('click', nextEntry);
        addLineBtn.addEventListener('click', addNewLine);
        restartBtn.addEventListener('click', restartGame);

        // Initialiser l'application
        init();
    </script>
</body>
</html>