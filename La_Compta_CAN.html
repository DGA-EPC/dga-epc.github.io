<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice de Comptabilité - CAN, PRAMV et BB</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000000;
        }
        
        .header {
            text-align: center;
            padding: 0px  10px;
			margin: 0 auto 30px auto; /* Centrage horizontal */
			max-width: 1370px;
            background-color: #78004f;
            color: white;
			position: relative;
			text-shadow: 2px 2px 4px rgba(0,0,0,1);
            border-radius: 20px;
            margin-bottom: 20px;
			border-top: 8px solid #24f400;
			border-bottom: 8px solid #ffff00;
			box-shadow: 0px 0px 15px 5px rgba(246,255,117,0.8);
        }
  
        
        .h1 {
            text-align: center;
            margin-top: 30px;
            font-style: bold;
            color: #ffffff;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-style: italic;
            color: #fa82d1;
        }
        
        .schemas-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
		}
        
        .schema {
            border: 2px solid #333;
            padding: 15px;
            width: 300px;
            min-height: 200px;
            background-color: white;
            border-radius: 12px;
        }
        
        .schema-title {
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        
        .drop-zone {
            min-height: 200px;
            padding: 10px;
            border: 1px dashed #999;
            border-radius: 3px;
        }
        
        .labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 12px;
            background-color: #432341;
			margin: 10px auto;
			max-width: 1370px;
        }
        
        .label {
            padding: 8px 12px;
            background-color: #e0e0e0;
            border: 1px solid #aaa;
            border-radius: 4px;
            cursor: move;
            user-select: none;
        }
        
    .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 20px 0;
    }
    
    button {
        padding: 10px 20px;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
		text-shadow: 1px 1px 2px rgba(0,0,0,1);
        transition: background-color 0.3s, transform 0.1s;
    }
    
    button:hover {
        transform: translateY(-3px);
        }
    
    button:active {
        transform: translateY(0);
    }
    
    #submit-btn {
        background-color: #61b865; /* Vert */
    }
    
    #submit-btn:hover {
        background-color: #00b50d;
		box-shadow: 0px 0px 15px 5px rgba(0,255,49,0.6);		
    }
    
    #reset-btn {
        background-color: #ffa500;
    }
    
    #reset-btn:hover {
        background-color: #ffbf47;
		box-shadow: 0px 0px 10px 5px rgba(255,255,75, 0.6);						
    }
    
    #solution-btn {
        background-color: #5eabcc; /* Bleu */
    }
    
    #solution-btn:hover {
        background-color: #0088c2;
		box-shadow: 0px 0px 10px 5px rgba(120,255,255, 0.6);
    }
    #quitter-btn {
        background-color: #ff4747;
    }
    
    #quitter-btn:hover {
        background-color: #ff0000;
		box-shadow: 0px 0px 10px 5px rgba(255,55,55, 0.6);
    }	
        
        .correct {
            border-color: green;
            background-color: #e8f5e9;
        }
        
        .incorrect {
            border-color: red;
            background-color: #ffebee;
        }
        
        .solution {
            display: none;
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #4caf50;
            background-color: #e8f5e9;
            border-radius: 5px;
        }
		
		.info-icon {
			position: absolute;
			top: 15px;
			right: 15px;
			background-color: #51FF46;
			color: black;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			text-align: center;
			line-height: 24px;
			font-weight: bold;
			cursor: pointer;
			font-size: 16px;
			font-style: italic;
			font-family: serif;
			box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
			transition: all 0.3s ease;
		}

		.info-icon:hover {
			background-color: #FDCF00;
			transform: scale(1.1);
		}
		
		.info-icon:hover::after {
			content: "Rappel de la théorie";
			position: absolute;
			top: -30px;
			right: 0;
			background: #333;
			color: white;
			padding: 5px 10px;
			border-radius: 4px;
			font-size: 12px;
			white-space: nowrap;
			font-style: normal;
			font-family: Arial, sans-serif;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
		}

		.modal-content {
			background-color: #3c3c54;
			margin: 5% auto;
			padding: 25px;
			border-radius: 10px;
			width: 80%;
			max-width: 600px;
			border: 3px solid #51FF46;
			box-shadow: 0px 0px 20px rgba(81, 255, 70, 0.5);
			position: relative;
		}

		.close {
			color: #ff4747;
			float: right;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			line-height: 1;
		}

		.close:hover {
			color: #ff0000;
			text-shadow: 0px 0px 10px rgba(255, 0, 0, 0.7);
		}
		
		.theory-title {
			color: #51FF46;
			border-bottom: 2px solid #FDCF00;
			padding-bottom: 10px;
			margin-top: 0;
		}

		.theory-content {
			line-height: 1.6;
			margin-top: 15px;
			color: white;
		}		
    </style>
</head>
<body>
    <div class="header">
        <h1>Calculs sur le compte de Résultat</h1>
		<div class="info-icon" onclick="showTheory()">i</div>
    </div>
    
    <div class="schemas-container">
        <div class="schema" id="schema1">
            <div class="schema-title">Calculez le CAN</div>
            <div class="drop-zone" data-schema="1"></div>
        </div>
        
        <div class="schema" id="schema2">
            <div class="schema-title">Calculez le PRAMA</div>
            <div class="drop-zone" data-schema="2"></div>
        </div>
        
        <div class="schema" id="schema3">
            <div class="schema-title">Calculez le PRAMV</div>
            <div class="drop-zone" data-schema="3"></div>
        </div>
        
        <div class="schema" id="schema4">
            <div class="schema-title">Calculez le résultat net</div>
            <div class="drop-zone" data-schema="4"></div>
        </div>
    </div>
    
    <div class="labels-container" id="labels-container">
        <!-- Labels will be generated by JavaScript -->
    </div>
    
	<div class="h1">
		<p>Cliquez "Valider" pour vérification. Les cadres verts sont corrects, les cadres rouges contiennent des erreurs.</p>
	</div>
    <div class="controls">
        <button id="submit-btn">Valider</button>
        <button id="reset-btn">Nouvel exercice</button>
        <button id="solution-btn">Afficher la solution</button>
		 <button id="quitter-btn" onclick="window.close()">Quitter</button>
    </div>
    
    <div class="solution" id="solution">
        <h3>Solution:</h3>
        <p><strong>Schéma 1 (CAN):</strong> Ventes de marchandises - Déductions accordées - Pertes sur créances = CAN</p>
        <p><strong>Schéma 2 (PRAMA):</strong> Achats de marchandises - Déductions obtenues - Prestations propres + Frais d'achats = PRAMA</p>
        <p><strong>Schéma 3 (PRAMV):</strong> PRAMA + diminution de stock - augmentation de stock = PRAMV</p>
        <p><strong>Schéma 4 (BB):</strong> CAN - PRAMV = BB</p>
    </div>
    
    <div class="footer">
        <p>"Je fais de la compta et c'est ma joie!", DG, EPC Fribourg</p>
    </div>
	
		<!-- Pop-up théorique -->
		<div id="theoryModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeTheory()">&times;</span>
				<h2 class="theory-title">Calculs sur le compte de Résultat</h2>
				<div class="theory-content">
					<p>Ventes<br>- Déductions accordées<br>- Pertes sur créances<br>= CAN</p>
					<p>Achats<br>- Déductions obtenues<br>+ Frais d'achats<br>- Prestations propres (= prélèvements privés)<br>= PRAMA</p>
					<p>PRAMA<br>+ diminution de stock<br>ou<br>- augmentation de stock<br>= PRAMV</p>
					<p>CAN<br>- PRAMV<br>= BB<br>- ACE (ou FG pour frais généraux)<br>= BN ou PN</p>
				</div>
			</div>
		</div>	

    <script>
		document.addEventListener('keydown', function(e) {
			if (e.keyCode == 123 || // F12
				(e.ctrlKey && e.shiftKey && e.keyCode == 73) || // Ctrl+Shift+I
				(e.ctrlKey && e.keyCode == 85)) { // Ctrl+U
				e.preventDefault();
			}
		});
		
		// Fonctions pour le pop-up théorique
		function showTheory() {
			document.getElementById('theoryModal').style.display = 'block';
		}

		function closeTheory() {
			document.getElementById('theoryModal').style.display = 'none';
		}

		// Fermer le pop-up si on clique en dehors
		window.onclick = function(event) {
			const modal = document.getElementById('theoryModal');
			if (event.target === modal) {
				closeTheory();
			}
		}	
        document.addEventListener('DOMContentLoaded', function() {
            // Define all labels (correct ones and traps)
            const allLabels = [
                // Schema 1 labels
                { id: 'ventes', text: 'Ventes de marchandises', schema: 1, operator: '' },
                { id: 'deductions-accordees', text: 'Déductions accordées', schema: 1, operator: '-' },
                { id: 'pertes-creances', text: 'Pertes sur créances', schema: 1, operator: '-' },
                { id: 'can', text: 'CAN', schema: 1, operator: '=' },
                
                // Schema 2 labels
                { id: 'achats', text: 'Achats de marchandises', schema: 2, operator: '' },
                { id: 'deductions-obtenues', text: 'Déductions obtenues', schema: 2, operator: '-' },
                { id: 'prestations', text: 'Prestations propres', schema: 2, operator: '-' },
                { id: 'frais-achats', text: 'Frais d\'achats', schema: 2, operator: '+' },
                { id: 'prama', text: 'PRAMA', schema: 2, operator: '=' },
                
                // Schema 3 labels
                { id: 'prama-ref', text: 'PRAMA', schema: 3, operator: '' },
                { id: 'diminution-stock', text: 'diminution de stock', schema: 3, operator: '+' },
                { id: 'augmentation-stock', text: 'augmentation de stock', schema: 3, operator: '-' },
                { id: 'pramv', text: 'PRAMV', schema: 3, operator: '=' },
                
                // Schema 4 labels
                { id: 'can-ref', text: 'CAN', schema: 4, operator: '' },
                { id: 'pramv-ref', text: 'PRAMV', schema: 4, operator: '-' },
                { id: 'bb', text: 'BB', schema: 4, operator: '=' },
				{ id: 'ace', text: 'ACE', schema: 4, operator: '-' },
				{ id: 'bn', text: 'BN/PN', schema: 4, operator: '=' },
                
                // Trap labels
                { id: 'trap1', text: '+ PRAMV', schema: 0, operator: '' },
                { id: 'trap2', text: '+ déductions accordées', schema: 0, operator: '' },
                { id: 'trap3', text: '+ augmentation de stock', schema: 0, operator: '' },
                { id: 'trap4', text: '+ Prestations propres', schema: 0, operator: '' },
                { id: 'trap5', text: '- diminution de stock', schema: 0, operator: '' },
                { id: 'trap6', text: '= PR', schema: 0, operator: '' },				
				{ id: 'trap7', text: '- Frais d\'achat', schema: 0, operator: '' },
				{ id: 'trap8', text: '+ ACE', schema: 0, operator: '' }
            ];
            
            const labelsContainer = document.getElementById('labels-container');
            const dropZones = document.querySelectorAll('.drop-zone');
            const submitBtn = document.getElementById('submit-btn');
            const resetBtn = document.getElementById('reset-btn');
            const solutionBtn = document.getElementById('solution-btn');
            const solutionDiv = document.getElementById('solution');
            
            // Initialize the game
            initGame();
            
			
			function initGame() {
            // Clear all drop zones
            dropZones.forEach(zone => {
                zone.innerHTML = '';
                zone.parentElement.classList.remove('correct', 'incorrect');
            });
            
            // Clear labels container
            labelsContainer.innerHTML = '';
            
            // Hide solution
            solutionDiv.style.display = 'none';
            
            // Mélanger aléatoirement les étiquettes
            const shuffledLabels = shuffleArray([...allLabels]);
            
            // Create and add labels to the container (dans un ordre aléatoire)
            shuffledLabels.forEach(labelData => {
                const label = document.createElement('div');
                label.className = 'label';
                label.textContent = (labelData.operator ? labelData.operator + ' ' : '') + labelData.text;
                label.setAttribute('data-id', labelData.id);
                label.setAttribute('draggable', 'true');
                
                // Add drag events
                label.addEventListener('dragstart', dragStart);
                
                labelsContainer.appendChild(label);
            });
        }
        
        // Fonction pour mélanger aléatoirement un tableau (algorithme de Fisher-Yates)
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
			
			
         
            
            function dragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.getAttribute('data-id'));
            }
            
            // Allow drop in drop zones
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => {
                    e.preventDefault();
                    zone.style.backgroundColor = '#f0f0f0';
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.style.backgroundColor = '';
                });
                
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.style.backgroundColor = '';
                    
                    const labelId = e.dataTransfer.getData('text/plain');
                    const label = document.querySelector(`.label[data-id="${labelId}"]`);
                    
                    if (label) {
                        // Remove from previous location and add to drop zone
                        label.remove();
                        
                        const newLabel = label.cloneNode(true);
                        newLabel.addEventListener('click', () => {
                            newLabel.remove();
                            labelsContainer.appendChild(label);
                        });
                        
                        zone.appendChild(newLabel);
                    }
                });
            });
            
// Submit button event
        submitBtn.addEventListener('click', () => {
            let allCorrect = true;
            
            // Check each schema
            for (let i = 1; i <= 4; i++) {
                const zone = document.querySelector(`.drop-zone[data-schema="${i}"]`);
                const labels = zone.querySelectorAll('.label');
                const schemaDiv = zone.parentElement;
                
                // Get the IDs of the labels in this schema
                const labelIds = Array.from(labels).map(label => label.getAttribute('data-id'));
                
                // Check if all required labels are present with flexible order for operations
                const requiredLabels = allLabels
                    .filter(label => label.schema === i)
                    .map(label => label.id);
                
                // Vérification spéciale pour permettre l'ordre flexible des opérations
                const isCorrect = checkFlexibleOrder(labelIds, requiredLabels, i);
                
                if (isCorrect) {
                    schemaDiv.classList.add('correct');
                    schemaDiv.classList.remove('incorrect');
                } else {
                    schemaDiv.classList.add('incorrect');
                    schemaDiv.classList.remove('correct');
                    allCorrect = false;
                }
            }
            
            if (allCorrect) {
                alert('Félicitations! Tous les schémas sont corrects.');
            }
        });
        
        // Fonction pour vérifier avec ordre flexible des opérations
        function checkFlexibleOrder(placedLabels, requiredLabels, schemaNum) {
            // Vérifier d'abord que tous les labels requis sont présents
            if (!arraysContainSameElements(placedLabels, requiredLabels)) {
                return false;
            }
            
            // Pour chaque schéma, vérifier l'ordre des éléments importants
            switch(schemaNum) {
                case 1: // CAN
                    // Ventes doit être en première position, CAN en dernière
                    return placedLabels[0] === 'ventes' && 
                           placedLabels[placedLabels.length - 1] === 'can';
                
                case 2: // PRAMA
                    // Achats doit être en première position, PRAMA en dernière
                    return placedLabels[0] === 'achats' && 
                           placedLabels[placedLabels.length - 1] === 'prama';
                
                case 3: // PRAMV
                    // PRAMA doit être en première position, PRAMV en dernière
                    return placedLabels[0] === 'prama-ref' && 
                           placedLabels[placedLabels.length - 1] === 'pramv';
                
                case 4: // BB
                    // CAN doit être en première position, BB en dernière
                    return placedLabels[0] === 'can-ref' && 
                           placedLabels[placedLabels.length - 1] === 'bn';
                
                default:
                    return false;
            }
        }
        
        // Helper function to check if two arrays contain the same elements (order doesn't matter)
        function arraysContainSameElements(a, b) {
            if (a.length !== b.length) return false;
            const sortedA = [...a].sort();
            const sortedB = [...b].sort();
            for (let i = 0; i < sortedA.length; i++) {
                if (sortedA[i] !== sortedB[i]) return false;
            }
            return true;
        }
            
            // Reset button event
            resetBtn.addEventListener('click', initGame);
            
            // Solution button event - MODIFIÉ
            solutionBtn.addEventListener('click', showSolution);
            
            // Nouvelle fonction pour afficher la solution
            function showSolution() {
                // Clear all drop zones
                dropZones.forEach(zone => {
                    zone.innerHTML = '';
                    zone.parentElement.classList.remove('correct', 'incorrect');
                });
                
                // Get all labels currently in the container
                const currentLabels = Array.from(labelsContainer.querySelectorAll('.label'));
                
                // Place correct labels in their respective drop zones
                for (let i = 1; i <= 4; i++) {
                    const zone = document.querySelector(`.drop-zone[data-schema="${i}"]`);
                    const correctLabels = allLabels.filter(label => label.schema === i);
                    
                    // Add correct labels to the drop zone in order
                    correctLabels.forEach(labelData => {
                        const label = document.querySelector(`.label[data-id="${labelData.id}"]`);
                        if (label) {
                            // Remove from container
                            label.remove();
                            
                            // Create a new label for the drop zone
                            const newLabel = label.cloneNode(true);
                            newLabel.addEventListener('click', () => {
                                newLabel.remove();
                                labelsContainer.appendChild(label);
                            });
                            
                            zone.appendChild(newLabel);
                        }
                    });
                }
                
                // Les traps restent dans le conteneur
            }
            
            // Helper function to compare arrays
            function arraysEqual(a, b) {
                if (a.length !== b.length) return false;
                for (let i = 0; i < a.length; i++) {
                    if (a[i] !== b[i]) return false;
                }
                return true;
            }
        });
    </script>
	
	
</body>
</html>