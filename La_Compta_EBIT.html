<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices de Compte de Résultat</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: black;
            color: #333;
        }
        
        header {
            background-color: #6a0dad; /* Violet foncé */
            color: white;
            padding: 10px 10px 10px;
            text-align: center;
            margin-bottom: 5px;
            position: relative;
            border-radius: 8px;
			max-width: 1180px;
			margin: 0px auto;
			text-shadow: 2px 2px 4px rgba(0,0,0,1);
            border-top: 5px solid #007bff; /* Bleu vif */
            border-bottom: 5px solid #ffc107; /* Jaune */
        }
        
        h1 {
            margin: 0;
            font-size: 2.2em;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .home-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 50px;
        }

        footer {
            text-align: center;
            padding: 15px;
            font-style: italic;
			color: #ffb5fb;
        }

     
        .exercise-card {
            background-color: #ebebeb;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 300px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
	
        
        .exercise-card:hover {
			background-color: #ffffff;

            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .exercise-card h2 {
            color: #6a0dad;
            margin-top: 0;
        }
        
        .exercise-card p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .btn {
            background-color: #6a0dad;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
			text-shadow: 1px 1px 2px rgba(0,0,0,1);
			box-shadow: 4px 4px 6px rgba(0,0,0,0.6);	
            transition: background-color 0.3s, transform 0.1s;
        }
        .btn:hover {
            transform: translateY(-3px);
			box-shadow: 6px 6px 8px rgba(0,0,0,0.6);	
        }
        
		.btn-valide {
			background-color: #61b865;
		}
		.btn-valide:hover {
			background-color: #00b50d;
		}
		.btn-quit {
			background-color: #ff4747;
			color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.1s;
		}
		.btn-quit:hover {
			transform: translateY(-3px);
			box-shadow: 0px 0px 15px 10px rgba(200,100,100,0.6);	
			background-color: #ff0000;
		}		
		
		.btn-solution {
			background-color: #5eabcc;
		}
		.btn-solution:hover {
			background-color: #0088c2;
		}
		
		.btn-nouveau {
			background-color: #ffbf47;
		}
		.btn-nouveau:hover {
			background-color: #ffa500;
		}
		
		.btn-calcul {
			background-color: #ABABAB;
		}
		.btn-calcul:hover {
			background-color: #4D4D4D;
		}
		
        .home-btn {
            padding: 10px 20px;
            border-radius: 5px;
			background-color: #DA95F5;
        }	
        .home-btn:hover {
			background-color: #52008C;
        }		
        
        .exercise {
            display: none;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px 20px;
            margin-top: 10px;
        }
        
        .exercise-title {
            color: #6a0dad;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .columns {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .column {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            min-height: 400px;
        }
        
        .column h3 {
            text-align: center;
            margin-top: 0;
            color: #6a0dad;
            border-bottom: 1px solid #eee;
            padding: 4px 4px;
        }
        
        .item {
            background-color: #f0f0f0;
            padding: 4px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: move;
            text-align: center;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table td {
            padding: 2px;
            border-bottom: 1px solid #dbdbdb;
        }

        
        .table .label {
            width: 70%;
        }
        
        .table .amount {
            width: 30%;
            text-align: right;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .incorrect {
            background-color: #ffcccc;
        }
        
        .correct {
            background-color: #ccffcc;
        }
        
        .amount-input {
            width: 80px;
            text-align: right;
            padding: 5px;
        }
        
       
        .clickable-item {
            cursor: pointer;
        }
        
        .clickable-item:hover {
            background-color: #e0e0e0;
        }
        
        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .solution-mode .amount-input {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            color: #333;
        }

    #numbers-container .item {
        text-align: left;
        padding-left: 10px;
    }

		
    /* Ajouter ce style spécifique pour l'exercice A */
    #table-A tr {
        height: 30px; /* Augmenter la hauteur des lignes pour l'exercice A */
    }
    
    /* Conserver la hauteur normale pour l'exercice B */
    #table-B tr {
        height: 2px; /* Ou une valeur plus petite si souhaité */
    }
    
    /* Optionnel : ajuster la hauteur des cellules de drop pour l'exercice A */
    #table-A .drop-target {
        height:28px;
        vertical-align: middle;
    }
	
		.info-icon {
			position: absolute;
			top: 15px;
			right: 15px;
			background-color: #51FF46;
			color: black;
			border-radius: 50%;
			width: 24px;
			height: 24px;
			text-align: center;
			line-height: 24px;
			font-weight: bold;
			cursor: pointer;
			font-size: 16px;
			font-style: italic;
			font-family: serif;
			box-shadow: 0px 0px 5px rgba(0,0,0,0.5);
			transition: all 0.3s ease;
		}

		.info-icon:hover {
			background-color: #FDCF00;
			transform: scale(1.1);
		}
		
		.info-icon:hover::after {
			content: "Rappel de la théorie";
			position: absolute;
			top: -30px;
			right: 0;
			background: #333;
			color: white;
			padding: 5px 10px;
			border-radius: 4px;
			font-size: 12px;
			white-space: nowrap;
			font-style: normal;
			font-family: Arial, sans-serif;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
		}

		.modal-content {
			background-color: #3c3c54;
			margin: 5% auto;
			padding: 25px;
			border-radius: 10px;
			width: 80%;
			max-width: 700px;
			border: 3px solid #51FF46;
			box-shadow: 0px 0px 20px rgba(81, 255, 70, 0.5);
			position: relative;
		}

		.close {
			color: #ff4747;
			float: right;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
			line-height: 1;
		}

		.close:hover {
			color: #ff0000;
			text-shadow: 0px 0px 10px rgba(255, 0, 0, 0.7);
		}
		
		.theory-title {
			color: #51FF46;
			border-bottom: 2px solid #FDCF00;
			padding-bottom: 10px;
			margin-top: 0;
		}

		.theory-content {
			line-height: 1.6;
			margin-top: 15px;
			color: white;
		}	
	
    </style>
</head>
<body>
	<div>
	<br>
	</div>
	<div>
	<header>
        <h1>Le Compte de Résultat</h1>
		<div class="info-icon" onclick="showTheory()">i</div>
    </header>
	</div>

    <div class="container" id="home-page">
        <div class="home-container">
            <div class="exercise-card" onclick="showExercise('A')">
                <h2>Exercice A</h2>
                <p>Reconstituer le Compte de résultat en replaçant les étiquettes dans le bon ordre.</p>
                <button class="btn">Commencer</button>
            </div>
            <div class="exercise-card" onclick="showExercise('B')">
                <h2>Exercice B</h2>
                <p>Calculer le Résultat en faisant ressortir les différents niveaux (EBIT, EBT, etc.).</p>
                <button class="btn">Commencer</button>
            </div>
        </div>
	<footer>
		<br>
		"Je fais de la compta et c'est ma joie!", DG, EPC-Fribourg
		<br><br>
		<button class="btn-quit" onclick="window.close()">Quitter</button>
	</footer>

    </div>

	

    <div class="container">
        <div id="exercise-A" class="exercise">
            <div class="exercise-header">
                <h2 class="exercise-title">Exercice A - Reconstituer le Compte de résultat</h2>
            </div>
            <div class="columns">
                <div class="column">
                    <h3>Étiquettes à placer à droite</h3>
                    <div id="labels-container-A"></div>
                </div>
                <div class="column">
                    <h3>Tableau à reconstituer</h3>
                    <table class="table" id="table-A">
                        <!-- Table will be generated by JavaScript -->
                    </table>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-valide" onclick="validateExerciseA()">Valider</button>
                <button class="btn btn-nouveau" onclick="resetExerciseA()">Nouvel exercice</button>
                <button class="btn btn-solution" onclick="showSolutionA()">Afficher la solution</button>
				<button class="btn home-btn" onclick="showHome()">← Retour à l'accueil</button>
            </div>
        </div>

        <div id="exercise-B" class="exercise">
            <div class="exercise-header">
                <h2 class="exercise-title">Exercice B - Calculer le Résultat</h2>

            </div>
            <div class="columns">
                <div class="column">
                    <h3>Montants</h3>
                    <div id="numbers-container"></div>
                </div>
                <div class="column">
                    <h3>Étiquettes à placer à droite</h3>
                    <div id="labels-container-B"></div>
                </div>
                <div class="column">
                    <h3>Tableau à compléter + montants</h3>
                    <table class="table" id="table-B">
                        <!-- Table will be generated by JavaScript -->
                    </table>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-calcul" onclick="calculateTotals()">Calculer les totaux</button>
				<button class="btn btn-valide" onclick="validateExerciseB()">Valider</button>
                <button class="btn btn-nouveau" onclick="resetExerciseB()">Nouvel exercice</button>
                <button class="btn btn-solution" onclick="showSolutionB()">Afficher la solution</button>
				<button class="btn home-btn" onclick="showHome()">← Retour à l'accueil</button>
            </div>
        </div>
    </div>

    <script>
		document.addEventListener('keydown', function(e) {
			if (e.keyCode == 123 || // F12
				(e.ctrlKey && e.shiftKey && e.keyCode == 73) || // Ctrl+Shift+I
				(e.ctrlKey && e.keyCode == 85)) { // Ctrl+U
				e.preventDefault();
			}
		});
		
        // Données pour les exercices
        const accountItems = [
            "Produit net des ventes",
            "Charges marchandises",
            "Marge brute",
            "Charges de personnel",
            "Autres charges d'exploitation",
            "EBITDA",
            "Amortissements",
            "EBIT",
            "Charges financières",
            "Produits financiers",
            "Bénéfice net d'exploitation",
            "Charges exceptionnelles",
            "Produits exceptionnels",
            "Bénéfice avant impôts (EBT)",
            "Impôts",
            "Bénéfice net d'exercice"
        ];

        let currentValues = {};
        let correctOrder = [];
        let currentExerciseBValues = {};
        let isSolutionShownB = false;

        // Afficher la page d'accueil
        function showHome() {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('exercise-A').style.display = 'none';
            document.getElementById('exercise-B').style.display = 'none';
            document.getElementById('exercise-B').classList.remove('solution-mode');
            isSolutionShownB = false;
        }

        // Afficher l'exercice sélectionné
        function showExercise(exercise) {
            document.getElementById('home-page').style.display = 'none';
            
            if (exercise === 'A') {
                document.getElementById('exercise-A').style.display = 'block';
                document.getElementById('exercise-B').style.display = 'none';
                document.getElementById('exercise-B').classList.remove('solution-mode');
                isSolutionShownB = false;
                resetExerciseA();
            } else {
                document.getElementById('exercise-A').style.display = 'none';
                document.getElementById('exercise-B').style.display = 'block';
                resetExerciseB();
            }
        }

        // Exercice A - Réinitialiser
        function resetExerciseA() {
            const labelsContainer = document.getElementById('labels-container-A');
            const table = document.getElementById('table-A');
            
            // Vider les conteneurs
            labelsContainer.innerHTML = '';
            table.innerHTML = '';
            
            // Mélanger les étiquettes
            const shuffledItems = [...accountItems].sort(() => Math.random() - 0.5);
            correctOrder = [...accountItems];
            
            // Ajouter les étiquettes mélangées
            shuffledItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item';
                div.textContent = item;
                div.draggable = true;
                div.addEventListener('dragstart', dragStart);
                labelsContainer.appendChild(div);
            });
            
            // Créer le tableau vide
            for (let i = 0; i < accountItems.length; i++) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.className = 'drop-target';
                cell.addEventListener('dragover', dragOver);
                cell.addEventListener('drop', drop);
                cell.dataset.expected = accountItems[i];
			
                
                // Ajouter la possibilité de cliquer pour retirer une étiquette
                cell.addEventListener('click', function() {
                    if (this.textContent !== '') {
                        returnToLabelsContainerA(this.textContent);
                        this.textContent = '';
                        this.classList.remove('correct', 'incorrect');
                    }
                });
                
                row.appendChild(cell);
                table.appendChild(row);
            }
        }

        // Exercice A - Retourner une étiquette au conteneur
        function returnToLabelsContainerA(labelText) {
            const labelsContainer = document.getElementById('labels-container-A');
            const div = document.createElement('div');
            div.className = 'item';
            div.textContent = labelText;
            div.draggable = true;
            div.addEventListener('dragstart', dragStart);
            labelsContainer.appendChild(div);
        }

        // Exercice A - Valider
        function validateExerciseA() {
            const rows = document.getElementById('table-A').rows;
            let allCorrect = true;
            
            for (let i = 0; i < rows.length; i++) {
                const cell = rows[i].cells[0];
                const expected = cell.dataset.expected;
                
                if (cell.textContent !== expected) {
                    cell.classList.add('incorrect');
                    cell.classList.remove('correct');
                    allCorrect = false;
                } else {
                    cell.classList.remove('incorrect');
                    cell.classList.add('correct');
                }
            }
            
            if (allCorrect) {
                alert('Félicitations! Vous avez correctement reconstitué le compte de résultat.');
            } else {
                alert('Il y a des erreurs dans votre reconstruction. Les cellules incorrectes sont surlignées en rouge.');
            }
        }

        // Exercice A - Afficher la solution
        function showSolutionA() {
            const rows = document.getElementById('table-A').rows;
            
            for (let i = 0; i < rows.length; i++) {
                const cell = rows[i].cells[0];
                cell.textContent = cell.dataset.expected;
                cell.classList.remove('incorrect');
                cell.classList.add('correct');
            }
            
            document.getElementById('labels-container-A').innerHTML = '';
        }

        // Exercice B - Réinitialiser
        function resetExerciseB() {
		    // Initialiser correctOrder pour l'exercice B
			correctOrder = [...accountItems];
            const numbersContainer = document.getElementById('numbers-container');
            const labelsContainer = document.getElementById('labels-container-B');
            const table = document.getElementById('table-B');
            
            // Vider les conteneurs
            numbersContainer.innerHTML = '';
            labelsContainer.innerHTML = '';
            table.innerHTML = '';
            
            // Générer des valeurs aléatoires par tranches de 10 (max 10000)
            const CAN = Math.floor(Math.random() * 1000) * 10 + 2000;
            const PRAMV = Math.floor(CAN * (0.5 + Math.random() * 0.2) / 10) * 10; // 50-70% du CAN
			const personnel = Math.floor(CAN * (0.15 + Math.random() * 0.10) / 10) * 10; // 15-25% du CAN
            //const personnel = Math.floor(Math.random() * 300) * 10 + 1000;
            const autresCharges = Math.floor(Math.random() * 20) * 10 + 500;
            const amortissements = Math.floor(Math.random() * 10) * 10 + 200;
            const chargesFinancieres = Math.floor(Math.random() * 80) * 5 + 200;
            const produitsFinanciers = Math.floor(Math.random() * 50) * 5 + 100;
            const chargesExceptionnelles = Math.floor(CAN * (0.01 + Math.random() * 0.01) / 10) * 10; // 1-2% du CAN
			//const chargesExceptionnelles = Math.floor(Math.random() * 60) * 10 + 100;
			const produitsExceptionnels = Math.floor(CAN * (0.01 + Math.random() * 0.01) / 10) * 10; // 1-2% du CAN
            // const produitsExceptionnels = Math.floor(Math.random() * 40) * 10 + 100;
            const impots = Math.floor(Math.random() * 100) * 10 + 100;
            
            // Stocker les valeurs pour la validation
            currentExerciseBValues = {
                "Produit net des ventes": CAN,
                "Charges marchandises": -PRAMV,
                "Marge brute": CAN - PRAMV,
                "Charges de personnel": -personnel,
                "Autres charges d'exploitation": -autresCharges,
                "EBITDA": CAN - PRAMV - personnel - autresCharges,
                "Amortissements": -amortissements,
                "EBIT": CAN - PRAMV - personnel - autresCharges - amortissements,
                "Charges financières": -chargesFinancieres,
                "Produits financiers": produitsFinanciers,
                "Bénéfice net d'exploitation": CAN - PRAMV - personnel - autresCharges - amortissements - chargesFinancieres + produitsFinanciers,
                "Charges exceptionnelles": -chargesExceptionnelles,
                "Produits exceptionnels": produitsExceptionnels,
                "Bénéfice avant impôts (EBT)": CAN - PRAMV - personnel - autresCharges - amortissements - chargesFinancieres + produitsFinanciers - chargesExceptionnelles + produitsExceptionnels,
                "Impôts": -impots,
                "Bénéfice net d'exercice": CAN - PRAMV - personnel - autresCharges - amortissements - chargesFinancieres + produitsFinanciers - chargesExceptionnelles + produitsExceptionnels - impots
            };
            
// Afficher les chiffres fournis dans un ordre aléatoire
const providedNumbers = [
    { label: "CAN", value: CAN },
    { label: "PRAMV", value: PRAMV },
    { label: "Charges personnel", value: personnel },
    { label: "Autres charges", value: autresCharges },
    { label: "Amortissements", value: amortissements },
    { label: "Charges financières", value: chargesFinancieres },
    { label: "Produits financiers", value: produitsFinanciers },
    { label: "Charges exceptionnelles", value: chargesExceptionnelles },
    { label: "Produits exceptionnels", value: produitsExceptionnels },
    { label: "Impôts", value: impots }
];

// Mélanger aléatoirement le tableau
for (let i = providedNumbers.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [providedNumbers[i], providedNumbers[j]] = [providedNumbers[j], providedNumbers[i]];
}

// Afficher les chiffres mélangés
providedNumbers.forEach(item => {
    const div = document.createElement('div');
    div.className = 'item';
    div.textContent = `${item.label}: ${item.value}`;
	div.style.textAlign = "left";
	div.style.paddingLeft = "10px";
    numbersContainer.appendChild(div);
});
            
            // Mélanger les étiquettes
            const shuffledItems = [...accountItems].sort(() => Math.random() - 0.5);
            
            // Ajouter les étiquettes mélangées
            shuffledItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item clickable-item';
                div.textContent = item;
                div.draggable = true;
                div.addEventListener('dragstart', dragStart);
                
                // Ajouter la possibilité de cliquer pour placer une étiquette
                div.addEventListener('click', function() {
                    placeLabelInTableB(this.textContent);
                    this.remove();
                });
                
                labelsContainer.appendChild(div);
            });
            
            // Créer le tableau avec les champs de saisie
            for (let i = 0; i < accountItems.length; i++) {
                const row = document.createElement('tr');
                
                const labelCell = document.createElement('td');
                labelCell.className = 'label drop-target';
                labelCell.addEventListener('dragover', dragOver);
                labelCell.addEventListener('drop', drop);
                labelCell.dataset.expected = accountItems[i];
                
                // Ajouter la possibilité de cliquer pour retirer une étiquette
                labelCell.addEventListener('click', function() {
                    if (this.textContent !== '' && !isSolutionShownB) {
                        returnToLabelsContainerB(this.textContent);
                        this.textContent = '';
                        this.classList.remove('correct', 'incorrect');
                        
                        // Réinitialiser le champ de montant correspondant
                        const amountCell = this.parentElement.cells[1];
                        const input = amountCell.querySelector('input');
                        if (input) {
                            input.value = '';
                            input.style.backgroundColor = '';
                        }
                    }
                });
                
                const amountCell = document.createElement('td');
                amountCell.className = 'amount';
                
                // Ajouter un champ de saisie pour TOUS les montants
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'amount-input';
                input.dataset.item = accountItems[i];
                // input.addEventListener('change', updateCalculatedFields);  // met à jour les montants
                
                amountCell.appendChild(input);
                
                row.appendChild(labelCell);
                row.appendChild(amountCell);
                table.appendChild(row);
            }
            
            // Réinitialiser l'état de la solution
            isSolutionShownB = false;
            document.getElementById('exercise-B').classList.remove('solution-mode');
        }

        // Exercice B - Placer une étiquette dans le tableau
        function placeLabelInTableB(labelText) {
            const rows = document.getElementById('table-B').rows;
            
            for (let i = 0; i < rows.length; i++) {
                const labelCell = rows[i].cells[0];
                
                if (labelCell.textContent === '') {
                    labelCell.textContent = labelText;
                    break;
                }
            }
            
            updateCalculatedFields();
        }

        // Exercice B - Retourner une étiquette au conteneur
        function returnToLabelsContainerB(labelText) {
            const labelsContainer = document.getElementById('labels-container-B');
            const div = document.createElement('div');
            div.className = 'item clickable-item';
            div.textContent = labelText;
            div.draggable = true;
            div.addEventListener('dragstart', dragStart);
            
            // Ajouter la possibilité de cliquer pour placer une étiquette
            div.addEventListener('click', function() {
                placeLabelInTableB(this.textContent);
                this.remove();
            });
            
            labelsContainer.appendChild(div);
        }

        // Exercice B - Mettre à jour les champs calculés
        function updateCalculatedFields() {
            if (isSolutionShownB) return; // Ne pas mettre à jour les calculs en mode solution
            
            const rows = document.getElementById('table-B').rows;
            const values = {};
            
            // Récupérer les valeurs saisies
            for (let i = 0; i < rows.length; i++) {
                const labelCell = rows[i].cells[0];
                const amountCell = rows[i].cells[1];
                const input = amountCell.querySelector('input');
                
                if (input && labelCell.textContent) {
                    let value = parseInt(input.value) || 0;
                    values[labelCell.textContent] = value;
                }
            }
            
            // Calculer les valeurs dérivées
            if (values["Produit net des ventes"] !== undefined && values["Charges marchandises"] !== undefined) {
                const margeBrute = values["Produit net des ventes"] + values["Charges marchandises"];
                updateCalculatedField("Marge brute", margeBrute);
                
                if (values["Charges de personnel"] !== undefined && values["Autres charges d'exploitation"] !== undefined) {
                    const ebitda = margeBrute + values["Charges de personnel"] + values["Autres charges d'exploitation"];
                    updateCalculatedField("EBITDA", ebitda);
                    
                    if (values["Amortissements"] !== undefined) {
                        const ebit = ebitda + values["Amortissements"];
                        updateCalculatedField("EBIT", ebit);
                        
                        if (values["Charges financières"] !== undefined && values["Produits financiers"] !== undefined) {
                            const beneficeExploitation = ebit + values["Charges financières"] + values["Produits financiers"];
                            updateCalculatedField("Bénéfice net d'exploitation", beneficeExploitation);
                            
                            if (values["Charges exceptionnelles"] !== undefined && values["Produits exceptionnels"] !== undefined) {
                                const ebt = beneficeExploitation + values["Charges exceptionnelles"] + values["Produits exceptionnels"];
                                updateCalculatedField("Bénéfice avant impôts (EBT)", ebt);
                                
                                if (values["Impôts"] !== undefined) {
                                    const beneficeNet = ebt + values["Impôts"];
                                    updateCalculatedField("Bénéfice net d'exercice", beneficeNet);
                                }
                            }
                        }
                    }
                }
            }
        }

function calculateTotals() {
    updateCalculatedFields();
}

        // Exercice B - Mettre à jour un champ calculé
        function updateCalculatedField(fieldName, value) {
            const rows = document.getElementById('table-B').rows;
            
            for (let i = 0; i < rows.length; i++) {
                const labelCell = rows[i].cells[0];
                
                if (labelCell.textContent === fieldName) {
                    const amountCell = rows[i].cells[1];
                    const input = amountCell.querySelector('input');
                    input.value = value >= 0 ? `+${value}` : value;
                    input.style.color = value >= 0 ? 'green' : 'red';
                    break;
                }
            }
        }

        // Exercice B - Valider
        function validateExerciseB() {
            if (isSolutionShownB) return; // Ne pas valider en mode solution
            
            const rows = document.getElementById('table-B').rows;
            let allLabelsCorrect = true;
            let allValuesCorrect = true;
            
            for (let i = 0; i < rows.length; i++) {
                const labelCell = rows[i].cells[0];
                const amountCell = rows[i].cells[1];
                const input = amountCell.querySelector('input');
                
                const itemName = labelCell.textContent;
                const expectedValue = currentExerciseBValues[itemName];
                
                // Vérifier si l'étiquette est correcte
                if (itemName !== correctOrder[i]) {
                    labelCell.classList.add('incorrect');
                    allLabelsCorrect = false;
                } else {
                    labelCell.classList.remove('incorrect');
                    labelCell.classList.add('correct');
                }
                
                // Vérifier si la valeur est correcte
                if (input) {
                    // Nettoyer la valeur (enlever le signe + et convertir en nombre)
                    let userValue = input.value;
                    if (userValue.startsWith('+')) {
                        userValue = userValue.substring(1);
                    }
                    userValue = parseInt(userValue) || 0;
                    
                    if (userValue !== expectedValue) {
                        input.style.backgroundColor = '#ffcccc';
                        allValuesCorrect = false;
                    } else {
                        input.style.backgroundColor = '';
                    }
                }
            }
            
            if (allLabelsCorrect && allValuesCorrect) {
                alert('Félicitations! Vous avez correctement complété le compte de résultat.');
            } else if (!allLabelsCorrect) {
                alert('Certaines étiquettes ne sont pas à la bonne place. Les cellules incorrectes sont surlignées en rouge.');
            } else {
                alert('Certaines valeurs sont incorrectes. Les cellules incorrectes sont surlignées en rouge.');
            }
        }

        // Exercice B - Afficher la solution
        function showSolutionB() {

			if (!correctOrder || correctOrder.length === 0) {
				correctOrder = [...accountItems];
    }
            const rows = document.getElementById('table-B').rows;
            const labelsContainer = document.getElementById('labels-container-B');
            
            // Vider le conteneur d'étiquettes
            labelsContainer.innerHTML = '';
            
            // Activer le mode solution
            isSolutionShownB = true;
            document.getElementById('exercise-B').classList.add('solution-mode');
            
            // Placer toutes les étiquettes et valeurs
            for (let i = 0; i < rows.length; i++) {
                const labelCell = rows[i].cells[0];
                const amountCell = rows[i].cells[1];
                const input = amountCell.querySelector('input');
                
                const itemName = correctOrder[i];
                const expectedValue = currentExerciseBValues[itemName];
                
                // Placer l'étiquette correcte
                labelCell.textContent = itemName;
                labelCell.classList.remove('incorrect');
                labelCell.classList.add('correct');
                
                // Désactiver le clic sur les étiquettes en mode solution
                labelCell.onclick = null;
                
                // Placer la valeur correcte
                if (input) {
                    input.value = expectedValue >= 0 ? `+${expectedValue}` : expectedValue;
                    input.style.color = expectedValue >= 0 ? 'green' : 'red';
                    input.style.backgroundColor = '';
                    input.disabled = true;
                }
            }
        }

        // Fonctions de glisser-déposer
        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.textContent);
        }

        function dragOver(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            const data = e.dataTransfer.getData('text/plain');
            
            if (e.target.classList.contains('drop-target')) {
                // Vérifier si la cellule est vide
                if (e.target.textContent === '') {
                    e.target.textContent = data;
                    
                    // Supprimer l'élément déplacé de son conteneur d'origine
                    const items = document.querySelectorAll('.item');
                    items.forEach(item => {
                        if (item.textContent === data) {
                            item.remove();
                        }
                    });
                }
            }
        }
		
		// Fonctions pour le pop-up théorique
		function showTheory() {
			document.getElementById('theoryModal').style.display = 'block';
		}

		function closeTheory() {
			document.getElementById('theoryModal').style.display = 'none';
		}

		// Fermer le pop-up si on clique en dehors
		window.onclick = function(event) {
			const modal = document.getElementById('theoryModal');
			if (event.target === modal) {
				closeTheory();
			}
		}		

        // Initialiser la page d'accueil
        showHome();
    </script>
	
		<!-- Pop-up théorique -->
		<div id="theoryModal" class="modal">
			<div class="modal-content">
				<span class="close" onclick="closeTheory()">&times;</span>
				<h2 class="theory-title">Rappel théorique</h2>
				<div class="theory-content">
					<p>Le code des obligations dit que le compte de Résultat doit faire ressortir le résultat net.<br>Bien insuffisant pour une analyse financière sérieuse.</p>
					<p><br>C'est pourquoi, des normes fixent une présention qui permet de faire ressortir :</p>
					<p><strong>Le résultat brut</strong>, appelé en pratique Bénéfice brut et, parfois, mais à tord, Marge brute</p>
					<p><strong>EBITDA</strong> : Earning Before Interest, Taxes, Depreciation and Amortization (Gain avant intérêts, impôts et amortissements)</p>
					<p><strong>EBIT</strong> : Earning Before Interest and Taxes (Gain avant intérêts et impôts)</p>
					<p><strong>EBT</strong> : Earning Before Taxes (Gain avant impôts)</p>
					<p><strong>Le résultat net d'exploitation</strong> : Gain ou la perte liée à l'activé de l'entreprise.</p>
					<p><strong>Le résultat de l'exercice</strong> : Inclut les charges et produits exceptionnels.</p>
				</div>
			</div>
		</div>
		
</body>
</html>